{"version":3,"file":"aurelia-validation.js","sources":["../../src/validator.ts","../../src/validate-result.ts","../../src/implementation/rules.ts","../../src/implementation/expression-visitor.ts","../../src/implementation/validation-message-parser.ts","../../src/implementation/validation-messages.ts","../../src/implementation/standard-validator.ts","../../src/validate-trigger.ts","../../src/config.ts","../../src/get-target-dom-element.ts","../../src/property-info.ts","../../src/util.ts","../../src/property-accessor-parser.ts","../../src/validate-event.ts","../../src/validation-controller.ts","../../src/validate-binding-behavior-base.ts","../../src/validate-binding-behavior.ts","../../src/validation-controller-factory.ts","../../src/validation-errors-custom-attribute.ts","../../src/validation-renderer-custom-attribute.ts","../../src/implementation/validation-rules.ts","../../src/aurelia-validation.ts"],"sourcesContent":["import { ValidateResult } from './validate-result';\r\n\r\n/**\r\n * Validates objects and properties.\r\n */\r\nexport abstract class Validator {\r\n  /**\r\n   * Validates the specified property.\r\n   * @param object The object to validate.\r\n   * @param propertyName The name of the property to validate.\r\n   * @param rules Optional. If unspecified, the implementation should lookup the rules for the\r\n   * specified object. This may not be possible for all implementations of this interface.\r\n   */\r\n  public abstract validateProperty(object: any, propertyName: string, rules?: any): Promise<ValidateResult[]>;\r\n\r\n  /**\r\n   * Validates all rules for specified object and it's properties.\r\n   * @param object The object to validate.\r\n   * @param rules Optional. If unspecified, the implementation should lookup the rules for the\r\n   * specified object. This may not be possible for all implementations of this interface.\r\n   */\r\n  public abstract validateObject(object: any, rules?: any): Promise<ValidateResult[]>;\r\n\r\n  /**\r\n   * Determines whether a rule exists in a set of rules.\r\n   * @param rules The rules to search.\r\n   * @parem rule The rule to find.\r\n   */\r\n  public abstract ruleExists(rules: any, rule: any): boolean;\r\n}\r\n","/**\r\n * The result of validating an individual validation rule.\r\n */\r\nexport class ValidateResult {\r\n  private static nextId = 0;\r\n\r\n  /**\r\n   * A number that uniquely identifies the result instance.\r\n   */\r\n  public id: number;\r\n\r\n  /**\r\n   * @param rule The rule associated with the result. Validator implementation specific.\r\n   * @param object The object that was validated.\r\n   * @param propertyName The name of the property that was validated.\r\n   * @param error The error, if the result is a validation error.\r\n   */\r\n  constructor(\r\n    public rule: any,\r\n    public object: any,\r\n    public propertyName: string | number | null,\r\n    public valid: boolean,\r\n    public message: string | null = null\r\n  ) {\r\n    this.id = ValidateResult.nextId++;\r\n  }\r\n\r\n  public toString() {\r\n    return this.valid ? 'Valid.' : this.message;\r\n  }\r\n}\r\n","import { Rule } from './rule';\r\n\r\n/**\r\n * Sets, unsets and retrieves rules on an object or constructor function.\r\n */\r\nexport class Rules {\r\n  /**\r\n   * The name of the property that stores the rules.\r\n   */\r\n  private static key = '__rules__';\r\n\r\n  /**\r\n   * Applies the rules to a target.\r\n   */\r\n  public static set(target: any, rules: Rule<any, any>[][]): void {\r\n    if (target instanceof Function) {\r\n      target = target.prototype;\r\n    }\r\n    Object.defineProperty(\r\n      target,\r\n      Rules.key,\r\n      { enumerable: false, configurable: false, writable: true, value: rules });\r\n  }\r\n\r\n  /**\r\n   * Removes rules from a target.\r\n   */\r\n  public static unset(target: any): void {\r\n    if (target instanceof Function) {\r\n      target = target.prototype;\r\n    }\r\n    target[Rules.key] = null;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the target's rules.\r\n   */\r\n  public static get(target: any): Rule<any, any>[][] | null {\r\n    return target[Rules.key] || null;\r\n  }\r\n}\r\n","import {\r\n  Expression,\r\n  ValueConverter,\r\n  Conditional,\r\n  AccessScope,\r\n  AccessMember,\r\n  AccessKeyed,\r\n  CallMember,\r\n  BindingBehavior,\r\n  Binary,\r\n  LiteralPrimitive,\r\n  LiteralString\r\n} from 'aurelia-binding';\r\n\r\n// tslint:disable:no-empty\r\nexport class ExpressionVisitor {\r\n  public visitChain(chain: any) {\r\n    this.visitArgs(chain.expressions);\r\n  }\r\n\r\n  public visitBindingBehavior(behavior: BindingBehavior) {\r\n    behavior.expression.accept(this);\r\n    this.visitArgs(behavior.args);\r\n  }\r\n\r\n  public visitValueConverter(converter: ValueConverter) {\r\n    converter.expression.accept(this);\r\n    this.visitArgs(converter.args);\r\n  }\r\n\r\n  public visitAssign(assign: any) {\r\n    assign.target.accept(this);\r\n    assign.value.accept(this);\r\n  }\r\n\r\n  public visitConditional(conditional: Conditional) {\r\n    conditional.condition.accept(this);\r\n    conditional.yes.accept(this);\r\n    conditional.no.accept(this);\r\n  }\r\n\r\n  public visitAccessThis(access: any) {\r\n    access.ancestor = access.ancestor;\r\n  }\r\n\r\n  public visitAccessScope(access: AccessScope) {\r\n    access.name = access.name;\r\n  }\r\n\r\n  public visitAccessMember(access: AccessMember) {\r\n    access.object.accept(this);\r\n  }\r\n\r\n  public visitAccessKeyed(access: AccessKeyed) {\r\n    access.object.accept(this);\r\n    access.key.accept(this);\r\n  }\r\n\r\n  public visitCallScope(call: any) {\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitCallFunction(call: any) {\r\n    call.func.accept(this);\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitCallMember(call: CallMember) {\r\n    call.object.accept(this);\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitPrefix(prefix: any) {\r\n    prefix.expression.accept(this);\r\n  }\r\n\r\n  public visitBinary(binary: Binary) {\r\n    binary.left.accept(this);\r\n    binary.right.accept(this);\r\n  }\r\n\r\n  public visitLiteralPrimitive(literal: LiteralPrimitive) {\r\n    literal.value = literal.value;\r\n  }\r\n\r\n  public visitLiteralArray(literal: any) {\r\n    this.visitArgs(literal.elements);\r\n  }\r\n\r\n  public visitLiteralObject(literal: any) {\r\n    this.visitArgs(literal.values);\r\n  }\r\n\r\n  public visitLiteralString(literal: LiteralString) {\r\n    literal.value = literal.value;\r\n  }\r\n\r\n  private visitArgs(args: Expression[]) {\r\n    for (let i = 0; i < args.length; i++) {\r\n      args[i].accept(this);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Expression,\r\n  AccessScope,\r\n  LiteralString,\r\n  Binary,\r\n  Conditional,\r\n  LiteralPrimitive,\r\n  CallMember\r\n} from 'aurelia-binding';\r\nimport { BindingLanguage } from 'aurelia-templating';\r\nimport * as LogManager from 'aurelia-logging';\r\nimport { ExpressionVisitor } from './expression-visitor';\r\n\r\nexport class ValidationMessageParser {\r\n  public static inject = [BindingLanguage];\r\n\r\n  private emptyStringExpression = new LiteralString('');\r\n  private nullExpression = new LiteralPrimitive(null);\r\n  private undefinedExpression = new LiteralPrimitive(undefined);\r\n  private cache: { [message: string]: Expression } = {};\r\n\r\n  constructor(private bindinqLanguage: BindingLanguage) { }\r\n\r\n  public parse(message: string): Expression {\r\n    if (this.cache[message] !== undefined) {\r\n      return this.cache[message];\r\n    }\r\n\r\n    const parts: (Expression | string)[] | null = (this.bindinqLanguage as any).parseInterpolation(null, message);\r\n    if (parts === null) {\r\n      return new LiteralString(message);\r\n    }\r\n    let expression: Expression = new LiteralString(parts[0] as string);\r\n    for (let i = 1; i < parts.length; i += 2) {\r\n      expression = new Binary(\r\n        '+',\r\n        expression,\r\n        new Binary(\r\n          '+',\r\n          this.coalesce(parts[i] as Expression),\r\n          new LiteralString(parts[i + 1] as string)\r\n        )\r\n      );\r\n    }\r\n\r\n    MessageExpressionValidator.validate(expression, message);\r\n\r\n    this.cache[message] = expression;\r\n\r\n    return expression;\r\n  }\r\n\r\n  private coalesce(part: Expression): Expression {\r\n    // part === null || part === undefined ? '' : part\r\n    return new Conditional(\r\n      new Binary(\r\n        '||',\r\n        new Binary('===', part, this.nullExpression),\r\n        new Binary('===', part, this.undefinedExpression)\r\n      ),\r\n      this.emptyStringExpression,\r\n      new CallMember(part, 'toString', [])\r\n    );\r\n  }\r\n}\r\n\r\nexport class MessageExpressionValidator extends ExpressionVisitor {\r\n  public static validate(expression: Expression, originalMessage: string) {\r\n    const visitor = new MessageExpressionValidator(originalMessage);\r\n    expression.accept(visitor);\r\n  }\r\n\r\n  constructor(private originalMessage: string) {\r\n    super();\r\n  }\r\n\r\n  public visitAccessScope(access: AccessScope) {\r\n    if (access.ancestor !== 0) {\r\n      throw new Error('$parent is not permitted in validation message expressions.');\r\n    }\r\n    if (['displayName', 'propertyName', 'value', 'object', 'config', 'getDisplayName'].indexOf(access.name) !== -1) {\r\n      LogManager.getLogger('aurelia-validation')\r\n        // tslint:disable-next-line:max-line-length\r\n        .warn(`Did you mean to use \"$${access.name}\" instead of \"${access.name}\" in this validation message template: \"${this.originalMessage}\"?`);\r\n    }\r\n  }\r\n}\r\n","import { Expression } from 'aurelia-binding';\r\nimport { ValidationMessageParser } from './validation-message-parser';\r\n\r\nexport interface ValidationMessages {\r\n  [key: string]: string;\r\n}\r\n\r\n/**\r\n * Dictionary of validation messages. [messageKey]: messageExpression\r\n */\r\nexport const validationMessages: ValidationMessages = {\r\n  /**\r\n   * The default validation message. Used with rules that have no standard message.\r\n   */\r\n  default: `\\${$displayName} is invalid.`,\r\n  required: `\\${$displayName} is required.`,\r\n  matches: `\\${$displayName} is not correctly formatted.`,\r\n  email: `\\${$displayName} is not a valid email.`,\r\n  minLength: `\\${$displayName} must be at least \\${$config.length} character\\${$config.length === 1 ? '' : 's'}.`,\r\n  maxLength: `\\${$displayName} cannot be longer than \\${$config.length} character\\${$config.length === 1 ? '' : 's'}.`,\r\n  minItems: `\\${$displayName} must contain at least \\${$config.count} item\\${$config.count === 1 ? '' : 's'}.`,\r\n  maxItems: `\\${$displayName} cannot contain more than \\${$config.count} item\\${$config.count === 1 ? '' : 's'}.`,\r\n  min: `\\${$displayName} must be at least \\${$config.constraint}.`,\r\n  max: `\\${$displayName} must be at most \\${$config.constraint}.`,\r\n  range: `\\${$displayName} must be between or equal to \\${$config.min} and \\${$config.max}.`,\r\n  between: `\\${$displayName} must be between but not equal to \\${$config.min} and \\${$config.max}.`,\r\n  equals: `\\${$displayName} must be \\${$config.expectedValue}.`,\r\n};\r\n\r\n/**\r\n * Retrieves validation messages and property display names.\r\n */\r\nexport class ValidationMessageProvider {\r\n  public static inject = [ValidationMessageParser];\r\n\r\n  constructor(public parser: ValidationMessageParser) { }\r\n\r\n  /**\r\n   * Returns a message binding expression that corresponds to the key.\r\n   * @param key The message key.\r\n   */\r\n  public getMessage(key: string): Expression {\r\n    let message: string;\r\n    if (key in validationMessages) {\r\n      message = validationMessages[key];\r\n    } else {\r\n      message = validationMessages['default'];\r\n    }\r\n    return this.parser.parse(message);\r\n  }\r\n\r\n  /**\r\n   * Formulates a property display name using the property name and the configured\r\n   * displayName (if provided).\r\n   * Override this with your own custom logic.\r\n   * @param propertyName The property name.\r\n   */\r\n  public getDisplayName(propertyName: string | number, displayName?: string | null | (() => string)): string {\r\n    if (displayName !== null && displayName !== undefined) {\r\n      return (displayName instanceof Function) ? displayName() : displayName as string;\r\n    }\r\n\r\n    // split on upper-case letters.\r\n    const words = propertyName.toString().split(/(?=[A-Z])/).join(' ');\r\n    // capitalize first letter.\r\n    return words.charAt(0).toUpperCase() + words.slice(1);\r\n  }\r\n}\r\n","import { Expression, LookupFunctions } from 'aurelia-binding';\r\nimport { ViewResources } from 'aurelia-templating';\r\nimport { Validator } from '../validator';\r\nimport { ValidateResult } from '../validate-result';\r\nimport { Rule } from './rule';\r\nimport { Rules } from './rules';\r\nimport { ValidationMessageProvider } from './validation-messages';\r\n\r\n/**\r\n * Validates.\r\n * Responsible for validating objects and properties.\r\n */\r\nexport class StandardValidator extends Validator {\r\n  public static inject = [ValidationMessageProvider, ViewResources];\r\n\r\n  private messageProvider: ValidationMessageProvider;\r\n  private lookupFunctions: LookupFunctions;\r\n  private getDisplayName: (propertyName: string) => string;\r\n\r\n  constructor(messageProvider: ValidationMessageProvider, resources: ViewResources) {\r\n    super();\r\n    this.messageProvider = messageProvider;\r\n    this.lookupFunctions = (resources as any).lookupFunctions;\r\n    this.getDisplayName = messageProvider.getDisplayName.bind(messageProvider);\r\n  }\r\n\r\n  /**\r\n   * Validates the specified property.\r\n   * @param object The object to validate.\r\n   * @param propertyName The name of the property to validate.\r\n   * @param rules Optional. If unspecified, the rules will be looked up using the metadata\r\n   * for the object created by ValidationRules....on(class/object)\r\n   */\r\n  public validateProperty(object: any, propertyName: string | number, rules?: any): Promise<ValidateResult[]> {\r\n    return this.validate(object, propertyName, rules || null);\r\n  }\r\n\r\n  /**\r\n   * Validates all rules for specified object and it's properties.\r\n   * @param object The object to validate.\r\n   * @param rules Optional. If unspecified, the rules will be looked up using the metadata\r\n   * for the object created by ValidationRules....on(class/object)\r\n   */\r\n  public validateObject(object: any, rules?: any): Promise<ValidateResult[]> {\r\n    return this.validate(object, null, rules || null);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a rule exists in a set of rules.\r\n   * @param rules The rules to search.\r\n   * @parem rule The rule to find.\r\n   */\r\n  public ruleExists(rules: Rule<any, any>[][], rule: Rule<any, any>): boolean {\r\n    let i = rules.length;\r\n    while (i--) {\r\n      if (rules[i].indexOf(rule) !== -1) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private getMessage(rule: Rule<any, any>, object: any, value: any): string {\r\n    const expression: Expression = rule.message || this.messageProvider.getMessage(rule.messageKey);\r\n    // tslint:disable-next-line:prefer-const\r\n    let { name: propertyName, displayName } = rule.property;\r\n    if (propertyName !== null) {\r\n      displayName = this.messageProvider.getDisplayName(propertyName, displayName);\r\n    }\r\n    const overrideContext: any = {\r\n      $displayName: displayName,\r\n      $propertyName: propertyName,\r\n      $value: value,\r\n      $object: object,\r\n      $config: rule.config,\r\n      // returns the name of a given property, given just the property name (irrespective of the property's displayName)\r\n      // split on capital letters, first letter ensured to be capitalized\r\n      $getDisplayName: this.getDisplayName\r\n    };\r\n    return expression.evaluate(\r\n      { bindingContext: object, overrideContext },\r\n      this.lookupFunctions);\r\n  }\r\n\r\n  private validateRuleSequence(\r\n    object: any,\r\n    propertyName: string | number | null,\r\n    ruleSequence: Rule<any, any>[][],\r\n    sequence: number,\r\n    results: ValidateResult[]\r\n  ): Promise<ValidateResult[]> {\r\n    // are we validating all properties or a single property?\r\n    const validateAllProperties = propertyName === null || propertyName === undefined;\r\n\r\n    const rules = ruleSequence[sequence];\r\n    let allValid = true;\r\n\r\n    // validate each rule.\r\n    const promises: Promise<boolean>[] = [];\r\n    for (let i = 0; i < rules.length; i++) {\r\n      const rule = rules[i];\r\n\r\n      // is the rule related to the property we're validating.\r\n      // tslint:disable-next-line:triple-equals | Use loose equality for property keys\r\n      if (!validateAllProperties && rule.property.name != propertyName) {\r\n        continue;\r\n      }\r\n\r\n      // is this a conditional rule? is the condition met?\r\n      if (rule.when && !rule.when(object)) {\r\n        continue;\r\n      }\r\n\r\n      // validate.\r\n      const value = rule.property.name === null ? object : object[rule.property.name];\r\n      let promiseOrBoolean = rule.condition(value, object);\r\n      if (!(promiseOrBoolean instanceof Promise)) {\r\n        promiseOrBoolean = Promise.resolve(promiseOrBoolean);\r\n      }\r\n      promises.push(promiseOrBoolean.then(valid => {\r\n          const message = valid ? null : this.getMessage(rule, object, value);\r\n          results.push(new ValidateResult(rule, object, rule.property.name, valid, message));\r\n          allValid = allValid && valid;\r\n          return valid;\r\n        }));\r\n    }\r\n\r\n    return Promise.all(promises)\r\n      .then(() => {\r\n      sequence++;\r\n      if (allValid && sequence < ruleSequence.length) {\r\n        return this.validateRuleSequence(object, propertyName, ruleSequence, sequence, results);\r\n      }\r\n      return results;\r\n    });\r\n  }\r\n\r\n  private validate(\r\n    object: any,\r\n    propertyName: string | number | null,\r\n    rules: Rule<any, any>[][] | null\r\n  ): Promise<ValidateResult[]> {\r\n    // rules specified?\r\n    if (!rules) {\r\n      // no. attempt to locate the rules.\r\n      rules = Rules.get(object);\r\n    }\r\n\r\n    // any rules?\r\n    if (!rules || rules.length === 0) {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    return this.validateRuleSequence(object, propertyName, rules, 0, []);\r\n  }\r\n}\r\n","/**\r\n * Validation triggers.\r\n */\r\nexport enum validateTrigger {\r\n  /**\r\n   * Manual validation.  Use the controller's `validate()` and  `reset()` methods\r\n   * to validate all bindings.\r\n   */\r\n  manual = 0,           // 0x000\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"blur\" event.\r\n   */\r\n  blur = 1,             // 0x001\r\n\r\n  /**\r\n   * Validate the binding when it updates the model due to a change in the view.\r\n   */\r\n  change = 2,           // 0x010\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"blur\" event and\r\n   * when it updates the model due to a change in the view.\r\n   */\r\n  changeOrBlur = 3,     // 0x011\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"focusout\" event.\r\n   * Unlike \"blur\", this event bubbles.\r\n   */\r\n  focusout = 4,         // 0x100\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"focusout\" event or\r\n   * when it updates the model due to a change in the view.\r\n   */\r\n  changeOrFocusout = 6, // 0x110\r\n}\r\n","import { Container } from 'aurelia-dependency-injection';\r\nimport { Validator } from './validator';\r\nimport { StandardValidator } from './implementation/standard-validator';\r\nimport { validateTrigger } from './validate-trigger';\r\n\r\nexport type ValidatorCtor = new (...args: any[]) => Validator;\r\n\r\n/**\r\n * Aurelia Validation Configuration API\r\n */\r\nexport class GlobalValidationConfiguration {\r\n  public static DEFAULT_VALIDATION_TRIGGER = validateTrigger.blur;\r\n\r\n  private validatorType: ValidatorCtor = StandardValidator;\r\n  private validationTrigger = GlobalValidationConfiguration.DEFAULT_VALIDATION_TRIGGER;\r\n\r\n  /**\r\n   * Use a custom Validator implementation.\r\n   */\r\n  public customValidator(type: ValidatorCtor) {\r\n    this.validatorType = type;\r\n    return this;\r\n  }\r\n\r\n  public defaultValidationTrigger(trigger: validateTrigger) {\r\n    this.validationTrigger = trigger;\r\n    return this;\r\n  }\r\n\r\n  public getDefaultValidationTrigger() {\r\n    return this.validationTrigger;\r\n  }\r\n\r\n  /**\r\n   * Applies the configuration.\r\n   */\r\n  public apply(container: Container) {\r\n    const validator = container.get(this.validatorType);\r\n    container.registerInstance(Validator, validator);\r\n    container.registerInstance(GlobalValidationConfiguration, this);\r\n  }\r\n}\r\n","import { DOM } from 'aurelia-pal';\r\n\r\n/**\r\n * Gets the DOM element associated with the data-binding. Most of the time it's\r\n * the binding.target but sometimes binding.target is an aurelia custom element,\r\n * or custom attribute which is a javascript \"class\" instance, so we need to use\r\n * the controller's container to retrieve the actual DOM element.\r\n */\r\nexport function getTargetDOMElement(binding: any, view: any): Element {\r\n  const target = binding.target;\r\n  // DOM element\r\n  if (target instanceof Element) {\r\n    return target;\r\n  }\r\n  // custom element or custom attribute\r\n  // tslint:disable-next-line:prefer-const\r\n  for (let i = 0, ii = view.controllers.length; i < ii; i++) {\r\n    const controller: any = view.controllers[i];\r\n    if (controller.viewModel === target) {\r\n      const element = controller.container.get(DOM.Element);\r\n      if (element) {\r\n        return element;\r\n      }\r\n      throw new Error(`Unable to locate target element for \"${binding.sourceExpression}\".`);\r\n    }\r\n  }\r\n  throw new Error(`Unable to locate target element for \"${binding.sourceExpression}\".`);\r\n}\r\n","import {\r\n  AccessMember,\r\n  AccessScope,\r\n  AccessKeyed,\r\n  BindingBehavior,\r\n  Expression,\r\n  ValueConverter,\r\n  Scope,\r\n  getContextFor\r\n} from 'aurelia-binding';\r\n\r\nfunction getObject(expression: Expression, objectExpression: Expression, source: any): null | undefined | object {\r\n  const value = objectExpression.evaluate(source, null as any);\r\n  if (value === null || value === undefined || value instanceof Object) {\r\n    return value;\r\n  }\r\n  // tslint:disable-next-line:max-line-length\r\n  throw new Error(`The '${objectExpression}' part of '${expression}' evaluates to ${value} instead of an object, null or undefined.`);\r\n}\r\n\r\n/**\r\n * Retrieves the object and property name for the specified expression.\r\n * @param expression The expression\r\n * @param source The scope\r\n */\r\nexport function getPropertyInfo(\r\n  expression: Expression,\r\n  source: Scope\r\n): { object: object; propertyName: string; } | null {\r\n  const originalExpression = expression;\r\n  while (expression instanceof BindingBehavior || expression instanceof ValueConverter) {\r\n    expression = expression.expression;\r\n  }\r\n\r\n  let object: null | undefined | object;\r\n  let propertyName: string;\r\n  if (expression instanceof AccessScope) {\r\n    object = getContextFor(expression.name, source, expression.ancestor);\r\n    propertyName = expression.name;\r\n  } else if (expression instanceof AccessMember) {\r\n    object = getObject(originalExpression, expression.object, source);\r\n    propertyName = expression.name;\r\n  } else if (expression instanceof AccessKeyed) {\r\n    object = getObject(originalExpression, expression.object, source);\r\n    propertyName = expression.key.evaluate(source);\r\n  } else {\r\n    throw new Error(`Expression '${originalExpression}' is not compatible with the validate binding-behavior.`);\r\n  }\r\n  if (object === null || object === undefined) {\r\n    return null;\r\n  }\r\n  return { object, propertyName };\r\n}\r\n","export function isString(value: any): boolean {\r\n  return Object.prototype.toString.call(value) === '[object String]';\r\n}\r\n\r\nexport function isNumber(value: any): boolean {\r\n  return Object.prototype.toString.call(value) === '[object Number]';\r\n}\r\n","import {\r\n  Parser,\r\n  AccessMember,\r\n  AccessScope\r\n} from 'aurelia-binding';\r\nimport { isString, isNumber } from './util';\r\n\r\nexport type PropertyAccessor<TObject, TValue> = (object: TObject) => TValue;\r\n\r\nexport class PropertyAccessorParser {\r\n  public static inject = [Parser];\r\n\r\n  constructor(private parser: Parser) { }\r\n\r\n  public parse<TObject, TValue>(property: string | number | PropertyAccessor<TObject, TValue>): string | number {\r\n    if (isString(property) || isNumber(property)) {\r\n      return property as string | number;\r\n    }\r\n    const accessorText = getAccessorExpression(property.toString());\r\n    const accessor = this.parser.parse(accessorText);\r\n    if (accessor instanceof AccessScope\r\n      || accessor instanceof AccessMember && accessor.object instanceof AccessScope) {\r\n      return accessor.name;\r\n    }\r\n    throw new Error(`Invalid property expression: \"${accessor}\"`);\r\n  }\r\n}\r\n\r\nexport function getAccessorExpression(fn: string): string {\r\n  /* tslint:disable:max-line-length */\r\n  const classic = /^function\\s*\\([$_\\w\\d]+\\)\\s*\\{(?:\\s*\"use strict\";)?(?:[$_\\s\\w\\d\\/\\*.['\"\\]+;\\(\\)]+)?\\s*return\\s+[$_\\w\\d]+\\.([$_\\w\\d]+)\\s*;?\\s*\\}$/;\r\n  /* tslint:enable:max-line-length */\r\n  const arrow = /^\\(?[$_\\w\\d]+\\)?\\s*=>\\s*[$_\\w\\d]+\\.([$_\\w\\d]+)$/;\r\n  const match = classic.exec(fn) || arrow.exec(fn);\r\n  if (match === null) {\r\n    throw new Error(`Unable to parse accessor function:\\n${fn}`);\r\n  }\r\n  return match[1];\r\n}\r\n","import { ValidateResult } from './validate-result';\r\nimport { ValidateInstruction } from './validate-instruction';\r\nimport { ControllerValidateResult } from './controller-validate-result';\r\n\r\nexport class ValidateEvent {\r\n  constructor(\r\n    /**\r\n     * The type of validate event. Either \"validate\" or \"reset\".\r\n     */\r\n    public readonly type: 'validate' | 'reset',\r\n\r\n    /**\r\n     * The controller's current array of errors. For an array containing both\r\n     * failed rules and passed rules, use the \"results\" property.\r\n     */\r\n    public readonly errors: ValidateResult[],\r\n\r\n    /**\r\n     * The controller's current array of validate results. This\r\n     * includes both passed rules and failed rules. For an array of only failed rules,\r\n     * use the \"errors\" property.\r\n     */\r\n    public readonly results: ValidateResult[],\r\n\r\n    /**\r\n     * The instruction passed to the \"validate\" or \"reset\" event. Will be null when\r\n     * the controller's validate/reset method was called with no instruction argument.\r\n     */\r\n    public readonly instruction: ValidateInstruction | null,\r\n\r\n    /**\r\n     * In events with type === \"validate\", this property will contain the result\r\n     * of validating the instruction (see \"instruction\" property). Use the controllerValidateResult\r\n     * to access the validate results specific to the call to \"validate\"\r\n     * (as opposed to using the \"results\" and \"errors\" properties to access the controller's entire\r\n     * set of results/errors).\r\n     */\r\n    public readonly controllerValidateResult: ControllerValidateResult | null\r\n\r\n  ) { }\r\n}\r\n","import { Binding, Expression } from 'aurelia-binding';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { Validator } from './validator';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { getPropertyInfo } from './property-info';\r\nimport { ValidationRenderer, RenderInstruction } from './validation-renderer';\r\nimport { ValidateResult } from './validate-result';\r\nimport { ValidateInstruction } from './validate-instruction';\r\nimport { ControllerValidateResult } from './controller-validate-result';\r\nimport { PropertyAccessorParser, PropertyAccessor } from './property-accessor-parser';\r\nimport { ValidateEvent } from './validate-event';\r\n\r\n/**\r\n * Orchestrates validation.\r\n * Manages a set of bindings, renderers and objects.\r\n * Exposes the current list of validation results for binding purposes.\r\n */\r\nexport class ValidationController {\r\n  public static inject = [Validator, PropertyAccessorParser, GlobalValidationConfiguration];\r\n\r\n  // Registered bindings (via the validate binding behavior)\r\n  private bindings = new Map<Binding, BindingInfo>();\r\n\r\n  // Renderers that have been added to the controller instance.\r\n  private renderers: ValidationRenderer[] = [];\r\n\r\n  /**\r\n   * Validation results that have been rendered by the controller.\r\n   */\r\n  private results: ValidateResult[] = [];\r\n\r\n  /**\r\n   * Validation errors that have been rendered by the controller.\r\n   */\r\n  public errors: ValidateResult[] = [];\r\n\r\n  /**\r\n   *  Whether the controller is currently validating.\r\n   */\r\n  public validating = false;\r\n\r\n  // Elements related to validation results that have been rendered.\r\n  private elements = new Map<ValidateResult, Element[]>();\r\n\r\n  // Objects that have been added to the controller instance (entity-style validation).\r\n  private objects = new Map<any, any>();\r\n\r\n  /**\r\n   * The trigger that will invoke automatic validation of a property used in a binding.\r\n   */\r\n  public validateTrigger: validateTrigger;\r\n\r\n  // Promise that resolves when validation has completed.\r\n  private finishValidating: Promise<any> = Promise.resolve();\r\n\r\n  private eventCallbacks: ((event: ValidateEvent) => void)[] = [];\r\n\r\n  constructor(\r\n    private validator: Validator,\r\n    private propertyParser: PropertyAccessorParser,\r\n    config?: GlobalValidationConfiguration,\r\n  ) {\r\n    this.validateTrigger = config instanceof GlobalValidationConfiguration\r\n        ? config.getDefaultValidationTrigger()\r\n        : GlobalValidationConfiguration.DEFAULT_VALIDATION_TRIGGER;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to controller validate and reset events. These events occur when the\r\n   * controller's \"validate\"\" and \"reset\" methods are called.\r\n   * @param callback The callback to be invoked when the controller validates or resets.\r\n   */\r\n  public subscribe(callback: (event: ValidateEvent) => void) {\r\n    this.eventCallbacks.push(callback);\r\n    return {\r\n      dispose: () => {\r\n        const index = this.eventCallbacks.indexOf(callback);\r\n        if (index === -1) {\r\n          return;\r\n        }\r\n        this.eventCallbacks.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Adds an object to the set of objects that should be validated when validate is called.\r\n   * @param object The object.\r\n   * @param rules Optional. The rules. If rules aren't supplied the Validator implementation will lookup the rules.\r\n   */\r\n  public addObject(object: any, rules?: any): void {\r\n    this.objects.set(object, rules);\r\n  }\r\n\r\n  /**\r\n   * Removes an object from the set of objects that should be validated when validate is called.\r\n   * @param object The object.\r\n   */\r\n  public removeObject(object: any): void {\r\n    this.objects.delete(object);\r\n    this.processResultDelta(\r\n      'reset',\r\n      this.results.filter(result => result.object === object),\r\n      []);\r\n  }\r\n\r\n  /**\r\n   * Adds and renders an error.\r\n   */\r\n  public addError<TObject>(\r\n    message: string,\r\n    object: TObject,\r\n    propertyName: string | PropertyAccessor<TObject, string> | null = null\r\n  ): ValidateResult {\r\n    let resolvedPropertyName: string | number | null;\r\n    if (propertyName === null) {\r\n      resolvedPropertyName = propertyName as any;\r\n    } else {\r\n      resolvedPropertyName = this.propertyParser.parse(propertyName);\r\n    }\r\n    const result = new ValidateResult({ __manuallyAdded__: true }, object, resolvedPropertyName, false, message);\r\n    this.processResultDelta('validate', [], [result]);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Removes and unrenders an error.\r\n   */\r\n  public removeError(result: ValidateResult) {\r\n    if (this.results.indexOf(result) !== -1) {\r\n      this.processResultDelta('reset', [result], []);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a renderer.\r\n   * @param renderer The renderer.\r\n   */\r\n  public addRenderer(renderer: ValidationRenderer) {\r\n    this.renderers.push(renderer);\r\n    renderer.render({\r\n      kind: 'validate',\r\n      render: this.results.map(result => ({ result, elements: this.elements.get(result) as Element[] })),\r\n      unrender: []\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Removes a renderer.\r\n   * @param renderer The renderer.\r\n   */\r\n  public removeRenderer(renderer: ValidationRenderer) {\r\n    this.renderers.splice(this.renderers.indexOf(renderer), 1);\r\n    renderer.render({\r\n      kind: 'reset',\r\n      render: [],\r\n      unrender: this.results.map(result => ({ result, elements: this.elements.get(result) as Element[] }))\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Registers a binding with the controller.\r\n   * @param binding The binding instance.\r\n   * @param target The DOM element.\r\n   * @param rules (optional) rules associated with the binding. Validator implementation specific.\r\n   */\r\n  public registerBinding(binding: Binding, target: Element, rules?: any) {\r\n    this.bindings.set(binding, { target, rules, propertyInfo: null });\r\n  }\r\n\r\n  /**\r\n   * Unregisters a binding with the controller.\r\n   * @param binding The binding instance.\r\n   */\r\n  public unregisterBinding(binding: Binding) {\r\n    this.resetBinding(binding);\r\n    this.bindings.delete(binding);\r\n  }\r\n\r\n  /**\r\n   * Interprets the instruction and returns a predicate that will identify\r\n   * relevant results in the list of rendered validation results.\r\n   */\r\n  private getInstructionPredicate(instruction?: ValidateInstruction): (result: ValidateResult) => boolean {\r\n    if (instruction) {\r\n      const { object, propertyName, rules } = instruction;\r\n      let predicate: (result: ValidateResult) => boolean;\r\n      if (instruction.propertyName) {\r\n        predicate = x => x.object === object && x.propertyName === propertyName;\r\n      } else {\r\n        predicate = x => x.object === object;\r\n      }\r\n      if (rules) {\r\n        return x => predicate(x) && this.validator.ruleExists(rules, x.rule);\r\n      }\r\n      return predicate;\r\n    } else {\r\n      return () => true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates and renders results.\r\n   * @param instruction Optional. Instructions on what to validate. If undefined, all\r\n   * objects and bindings will be validated.\r\n   */\r\n  public validate(instruction?: ValidateInstruction): Promise<ControllerValidateResult> {\r\n    // Get a function that will process the validation instruction.\r\n    let execute: () => Promise<ValidateResult[]>;\r\n    if (instruction) {\r\n      // tslint:disable-next-line:prefer-const\r\n      let { object, propertyName, rules } = instruction;\r\n      // if rules were not specified, check the object map.\r\n      rules = rules || this.objects.get(object);\r\n      // property specified?\r\n      if (instruction.propertyName === undefined) {\r\n        // validate the specified object.\r\n        execute = () => this.validator.validateObject(object, rules);\r\n      } else {\r\n        // validate the specified property.\r\n        execute = () => this.validator.validateProperty(object, propertyName, rules);\r\n      }\r\n    } else {\r\n      // validate all objects and bindings.\r\n      execute = () => {\r\n        const promises: Promise<ValidateResult[]>[] = [];\r\n        for (const [object, rules] of Array.from(this.objects)) {\r\n          promises.push(this.validator.validateObject(object, rules));\r\n        }\r\n        for (const [binding, { rules }] of Array.from(this.bindings)) {\r\n          const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n          if (!propertyInfo || this.objects.has(propertyInfo.object)) {\r\n            continue;\r\n          }\r\n          promises.push(this.validator.validateProperty(propertyInfo.object, propertyInfo.propertyName, rules));\r\n        }\r\n        return Promise.all(promises).then(resultSets => resultSets.reduce((a, b) => a.concat(b), []));\r\n      };\r\n    }\r\n\r\n    // Wait for any existing validation to finish, execute the instruction, render the results.\r\n    this.validating = true;\r\n    const returnPromise: Promise<ControllerValidateResult> = this.finishValidating\r\n      .then(execute)\r\n      .then((newResults: ValidateResult[]) => {\r\n        const predicate = this.getInstructionPredicate(instruction);\r\n        const oldResults = this.results.filter(predicate);\r\n        this.processResultDelta('validate', oldResults, newResults);\r\n        if (returnPromise === this.finishValidating) {\r\n          this.validating = false;\r\n        }\r\n        const result: ControllerValidateResult = {\r\n          instruction,\r\n          valid: newResults.find(x => !x.valid) === undefined,\r\n          results: newResults\r\n        };\r\n        this.invokeCallbacks(instruction, result);\r\n        return result;\r\n      })\r\n      .catch(exception => {\r\n        // recover, to enable subsequent calls to validate()\r\n        this.validating = false;\r\n        this.finishValidating = Promise.resolve();\r\n\r\n        return Promise.reject(exception);\r\n      });\r\n\r\n    this.finishValidating = returnPromise;\r\n\r\n    return returnPromise;\r\n  }\r\n\r\n  /**\r\n   * Resets any rendered validation results (unrenders).\r\n   * @param instruction Optional. Instructions on what to reset. If unspecified all rendered results\r\n   * will be unrendered.\r\n   */\r\n  public reset(instruction?: ValidateInstruction) {\r\n    const predicate = this.getInstructionPredicate(instruction);\r\n    const oldResults = this.results.filter(predicate);\r\n    this.processResultDelta('reset', oldResults, []);\r\n    this.invokeCallbacks(instruction, null);\r\n  }\r\n\r\n  /**\r\n   * Gets the elements associated with an object and propertyName (if any).\r\n   */\r\n  private getAssociatedElements({ object, propertyName }: ValidateResult): Element[] {\r\n    const elements: Element[] = [];\r\n    for (const [binding, { target }] of Array.from(this.bindings)) {\r\n      const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n      if (propertyInfo && propertyInfo.object === object && propertyInfo.propertyName === propertyName) {\r\n        elements.push(target);\r\n      }\r\n    }\r\n    return elements;\r\n  }\r\n\r\n  private processResultDelta(\r\n    kind: 'validate' | 'reset',\r\n    oldResults: ValidateResult[], newResults: ValidateResult[]\r\n  ) {\r\n    // prepare the instruction.\r\n    const instruction: RenderInstruction = {\r\n      kind,\r\n      render: [],\r\n      unrender: []\r\n    };\r\n\r\n    // create a shallow copy of newResults so we can mutate it without causing side-effects.\r\n    newResults = newResults.slice(0);\r\n\r\n    // create unrender instructions from the old results.\r\n    for (const oldResult of oldResults) {\r\n      // get the elements associated with the old result.\r\n      const elements = this.elements.get(oldResult) as Element[];\r\n\r\n      // remove the old result from the element map.\r\n      this.elements.delete(oldResult);\r\n\r\n      // create the unrender instruction.\r\n      instruction.unrender.push({ result: oldResult, elements });\r\n\r\n      // determine if there's a corresponding new result for the old result we are unrendering.\r\n      const newResultIndex = newResults.findIndex(\r\n        x => x.rule === oldResult.rule && x.object === oldResult.object && x.propertyName === oldResult.propertyName);\r\n      if (newResultIndex === -1) {\r\n        // no corresponding new result... simple remove.\r\n        this.results.splice(this.results.indexOf(oldResult), 1);\r\n        if (!oldResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1);\r\n        }\r\n      } else {\r\n        // there is a corresponding new result...\r\n        const newResult = newResults.splice(newResultIndex, 1)[0];\r\n\r\n        // get the elements that are associated with the new result.\r\n        const elements = this.getAssociatedElements(newResult);\r\n        this.elements.set(newResult, elements);\r\n\r\n        // create a render instruction for the new result.\r\n        instruction.render.push({ result: newResult, elements });\r\n\r\n        // do an in-place replacement of the old result with the new result.\r\n        // this ensures any repeats bound to this.results will not thrash.\r\n        this.results.splice(this.results.indexOf(oldResult), 1, newResult);\r\n        if (!oldResult.valid && newResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1);\r\n        } else if (!oldResult.valid && !newResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1, newResult);\r\n        } else if (!newResult.valid) {\r\n          this.errors.push(newResult);\r\n        }\r\n      }\r\n    }\r\n\r\n    // create render instructions from the remaining new results.\r\n    for (const result of newResults) {\r\n      const elements = this.getAssociatedElements(result);\r\n      instruction.render.push({ result, elements });\r\n      this.elements.set(result, elements);\r\n      this.results.push(result);\r\n      if (!result.valid) {\r\n        this.errors.push(result);\r\n      }\r\n    }\r\n\r\n    // render.\r\n    for (const renderer of this.renderers) {\r\n      renderer.render(instruction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates the property associated with a binding.\r\n   */\r\n  public validateBinding(binding: Binding) {\r\n    if (!binding.isBound) {\r\n      return;\r\n    }\r\n    const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n    let rules;\r\n    const registeredBinding = this.bindings.get(binding);\r\n    if (registeredBinding) {\r\n      rules = registeredBinding.rules;\r\n      registeredBinding.propertyInfo = propertyInfo;\r\n    }\r\n    if (!propertyInfo) {\r\n      return;\r\n    }\r\n    const { object, propertyName } = propertyInfo;\r\n    this.validate({ object, propertyName, rules });\r\n  }\r\n\r\n  /**\r\n   * Resets the results for a property associated with a binding.\r\n   */\r\n  public resetBinding(binding: Binding) {\r\n    const registeredBinding = this.bindings.get(binding);\r\n    let propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n    if (!propertyInfo && registeredBinding) {\r\n      propertyInfo = registeredBinding.propertyInfo;\r\n    }\r\n    if (registeredBinding) {\r\n      registeredBinding.propertyInfo = null;\r\n    }\r\n    if (!propertyInfo) {\r\n      return;\r\n    }\r\n    const { object, propertyName } = propertyInfo;\r\n    this.reset({ object, propertyName });\r\n  }\r\n\r\n  /**\r\n   * Changes the controller's validateTrigger.\r\n   * @param newTrigger The new validateTrigger\r\n   */\r\n  public changeTrigger(newTrigger: validateTrigger) {\r\n    this.validateTrigger = newTrigger;\r\n    const bindings = Array.from(this.bindings.keys());\r\n    for (const binding of bindings) {\r\n      const source = binding.source;\r\n      binding.unbind();\r\n      binding.bind(source);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Revalidates the controller's current set of errors.\r\n   */\r\n  public revalidateErrors() {\r\n    for (const { object, propertyName, rule } of this.errors) {\r\n      if (rule.__manuallyAdded__) {\r\n        continue;\r\n      }\r\n      const rules = [[rule]];\r\n      this.validate({ object, propertyName, rules });\r\n    }\r\n  }\r\n\r\n  private invokeCallbacks(instruction: ValidateInstruction | undefined, result: ControllerValidateResult | null) {\r\n    if (this.eventCallbacks.length === 0) {\r\n      return;\r\n    }\r\n    const event = new ValidateEvent(\r\n      result ? 'validate' : 'reset',\r\n      this.errors,\r\n      this.results,\r\n      instruction || null,\r\n      result);\r\n    for (let i = 0; i < this.eventCallbacks.length; i++) {\r\n      this.eventCallbacks[i](event);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Information related to an \"& validate\" decorated binding.\r\n */\r\nexport interface BindingInfo {\r\n  /**\r\n   * The DOM element associated with the binding.\r\n   */\r\n  target: Element;\r\n\r\n  /**\r\n   * The rules associated with the binding via the validate binding behavior's rules parameter.\r\n   */\r\n  rules?: any;\r\n\r\n  /**\r\n   * The object and property associated with the binding.\r\n   */\r\n  propertyInfo: { object: any; propertyName: string; } | null;\r\n}\r\n","// tslint:disable:no-bitwise\r\nimport { Optional } from 'aurelia-dependency-injection';\r\nimport { TaskQueue } from 'aurelia-task-queue';\r\nimport { ValidationController } from './validation-controller';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { getTargetDOMElement } from './get-target-dom-element';\r\nimport { getPropertyInfo } from './property-info';\r\nimport { Expression } from 'aurelia-binding';\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated.\r\n */\r\nexport abstract class ValidateBindingBehaviorBase {\r\n  constructor(private taskQueue: TaskQueue) { }\r\n\r\n  protected abstract getValidateTrigger(controller: ValidationController): validateTrigger;\r\n\r\n  public bind(binding: any, source: any, rulesOrController?: ValidationController | any, rules?: any) {\r\n    // identify the target element.\r\n    const target = getTargetDOMElement(binding, source);\r\n\r\n    // locate the controller.\r\n    let controller: ValidationController;\r\n    if (rulesOrController instanceof ValidationController) {\r\n      controller = rulesOrController;\r\n    } else {\r\n      controller = source.container.get(Optional.of(ValidationController));\r\n      rules = rulesOrController;\r\n    }\r\n    if (controller === null) {\r\n      throw new Error(`A ValidationController has not been registered.`);\r\n    }\r\n\r\n    controller.registerBinding(binding, target, rules);\r\n    binding.validationController = controller;\r\n    const trigger = this.getValidateTrigger(controller);\r\n    const event =\r\n      (trigger & validateTrigger.blur) === validateTrigger.blur ? 'blur'\r\n        : (trigger & validateTrigger.focusout) === validateTrigger.focusout ? 'focusout'\r\n          : null;\r\n    const hasChangeTrigger = (trigger & validateTrigger.change) === validateTrigger.change;\r\n    binding.isDirty = !hasChangeTrigger;\r\n    // validatedOnce is used to control whether controller should validate upon user input\r\n    //\r\n    // always true when validation trigger doesn't include \"blur\" event (blur/focusout)\r\n    // else it will be set to true after (a) the first user input & loss of focus or (b) validation\r\n    binding.validatedOnce = hasChangeTrigger && event === null;\r\n    if (hasChangeTrigger) {\r\n      binding.vbbUpdateSource = binding.updateSource;\r\n      // tslint:disable-next-line:only-arrow-functions\r\n      // tslint:disable-next-line:space-before-function-paren\r\n      binding.updateSource = function (value: any) {\r\n        this.vbbUpdateSource(value);\r\n        this.isDirty = true;\r\n        if (this.validatedOnce) {\r\n          this.validationController.validateBinding(this);\r\n        }\r\n      };\r\n    }\r\n\r\n    if (event !== null) {\r\n      binding.focusLossHandler = () => {\r\n        this.taskQueue.queueMicroTask(() => {\r\n          if (binding.isDirty) {\r\n            controller.validateBinding(binding);\r\n            binding.validatedOnce = true;\r\n          }\r\n        });\r\n      };\r\n      binding.validationTriggerEvent = event;\r\n      binding.validateTarget = target;\r\n      target.addEventListener(event, binding.focusLossHandler);\r\n      if (hasChangeTrigger) {\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        const { propertyName } = getPropertyInfo(binding.sourceExpression as Expression, binding.source)!;\r\n        binding.validationSubscription = controller.subscribe((event) => {\r\n          if (!binding.validatedOnce && event.type === 'validate') {\r\n            binding.validatedOnce = event.errors.findIndex((e) => e.propertyName === propertyName) > -1;\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    if (trigger !== validateTrigger.manual) {\r\n      binding.standardUpdateTarget = binding.updateTarget;\r\n      // tslint:disable-next-line:only-arrow-functions\r\n      // tslint:disable-next-line:space-before-function-paren\r\n      binding.updateTarget = function (value: any) {\r\n        this.standardUpdateTarget(value);\r\n        this.validationController.resetBinding(this);\r\n      };\r\n    }\r\n  }\r\n\r\n  public unbind(binding: any) {\r\n    // reset the binding to it's original state.\r\n    if (binding.vbbUpdateSource) {\r\n      binding.updateSource = binding.vbbUpdateSource;\r\n      binding.vbbUpdateSource = null;\r\n    }\r\n    if (binding.standardUpdateTarget) {\r\n      binding.updateTarget = binding.standardUpdateTarget;\r\n      binding.standardUpdateTarget = null;\r\n    }\r\n    if (binding.focusLossHandler) {\r\n      binding.validateTarget.removeEventListener(binding.validationTriggerEvent, binding.focusLossHandler);\r\n      binding.focusLossHandler = null;\r\n      binding.validateTarget = null;\r\n    }\r\n    if (binding.validationSubscription) {\r\n      binding.validationSubscription.dispose();\r\n      binding.validationSubscription = null;\r\n    }\r\n    binding.validationController.unregisterBinding(binding);\r\n    binding.validationController = null;\r\n    binding.isDirty = null;\r\n    binding.validatedOnce = null;\r\n  }\r\n}\r\n","import { TaskQueue } from 'aurelia-task-queue';\r\nimport { ValidationController } from './validation-controller';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { ValidateBindingBehaviorBase } from './validate-binding-behavior-base';\r\nimport { bindingBehavior } from 'aurelia-binding';\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the validate trigger specified by the associated controller's\r\n * validateTrigger property occurs.\r\n */\r\n@bindingBehavior('validate')\r\nexport class ValidateBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger(controller: ValidationController) {\r\n    return controller.validateTrigger;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property will be validated\r\n * manually, by calling controller.validate(). No automatic validation\r\n * triggered by data-entry or blur will occur.\r\n */\r\n@bindingBehavior('validateManually')\r\nexport class ValidateManuallyBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.manual;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element blurs.\r\n */\r\n@bindingBehavior('validateOnBlur')\r\nexport class ValidateOnBlurBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.blur;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element is changed by the user, causing a change\r\n * to the model.\r\n */\r\n@bindingBehavior('validateOnChange')\r\nexport class ValidateOnChangeBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.change;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element blurs or is changed by the user, causing\r\n * a change to the model.\r\n */\r\n@bindingBehavior('validateOnChangeOrBlur')\r\nexport class ValidateOnChangeOrBlurBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.changeOrBlur;\r\n  }\r\n}\r\n\r\n@bindingBehavior('validateOnFocusout')\r\nexport class ValidateOnFocusoutBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.focusout;\r\n  }\r\n}\r\n\r\n@bindingBehavior('validateOnChangeOrFocusout')\r\nexport class ValidateOnChangeOrFocusoutBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.changeOrFocusout;\r\n  }\r\n}\r\n","import { Container } from 'aurelia-dependency-injection';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { ValidationController } from './validation-controller';\r\nimport { Validator } from './validator';\r\nimport { PropertyAccessorParser } from './property-accessor-parser';\r\n\r\n/**\r\n * Creates ValidationController instances.\r\n */\r\nexport class ValidationControllerFactory {\r\n  public static get(container: Container) {\r\n    return new ValidationControllerFactory(container);\r\n  }\r\n\r\n  constructor(private container: Container) { }\r\n\r\n  /**\r\n   * Creates a new controller instance.\r\n   */\r\n  public create(validator?: Validator) {\r\n    if (!validator) {\r\n      validator = this.container.get(Validator) as Validator;\r\n    }\r\n    const propertyParser = this.container.get(PropertyAccessorParser) as PropertyAccessorParser;\r\n    const config = this.container.get(GlobalValidationConfiguration) as GlobalValidationConfiguration;\r\n    return new ValidationController(validator, propertyParser, config);\r\n  }\r\n\r\n  /**\r\n   * Creates a new controller and registers it in the current element's container so that it's\r\n   * available to the validate binding behavior and renderers.\r\n   */\r\n  public createForCurrentScope(validator?: Validator) {\r\n    const controller = this.create(validator);\r\n    this.container.registerInstance(ValidationController, controller);\r\n    return controller;\r\n  }\r\n}\r\n\r\n(ValidationControllerFactory as any)['protocol:aurelia:resolver'] = true;\r\n","import { bindingMode } from 'aurelia-binding';\r\nimport { Lazy } from 'aurelia-dependency-injection';\r\nimport { customAttribute, bindable } from 'aurelia-templating';\r\nimport { ValidationController } from './validation-controller';\r\nimport { ValidateResult } from './validate-result';\r\nimport { ValidationRenderer, RenderInstruction } from './validation-renderer';\r\nimport { DOM } from 'aurelia-pal';\r\n\r\nexport interface RenderedError {\r\n  error: ValidateResult;\r\n  targets: Element[];\r\n}\r\n\r\n@customAttribute('validation-errors')\r\nexport class ValidationErrorsCustomAttribute implements ValidationRenderer {\r\n\r\n  public static inject(): [typeof DOM.Element, Lazy<ValidationController>] {\r\n    return [DOM.Element, Lazy.of(ValidationController)];\r\n  }\r\n\r\n  @bindable({ defaultBindingMode: bindingMode.oneWay })\r\n  public controller: ValidationController | null = null;\r\n\r\n  @bindable({ primaryProperty: true, defaultBindingMode: bindingMode.twoWay })\r\n  public errors: RenderedError[] = [];\r\n\r\n  private errorsInternal: RenderedError[] = [];\r\n\r\n  constructor(private boundaryElement: Element, private controllerAccessor: () => ValidationController) {\r\n  }\r\n\r\n  public sort() {\r\n    this.errorsInternal.sort((a, b) => {\r\n      if (a.targets[0] === b.targets[0]) {\r\n        return 0;\r\n      }\r\n      // tslint:disable-next-line:no-bitwise\r\n      return a.targets[0].compareDocumentPosition(b.targets[0]) & 2 ? 1 : -1;\r\n    });\r\n  }\r\n\r\n  public interestingElements(elements: Element[]): Element[] {\r\n    return elements.filter(e => this.boundaryElement.contains(e));\r\n  }\r\n\r\n  public render(instruction: RenderInstruction) {\r\n    for (const { result } of instruction.unrender) {\r\n      const index = this.errorsInternal.findIndex(x => x.error === result);\r\n      if (index !== -1) {\r\n        this.errorsInternal.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    for (const { result, elements } of instruction.render) {\r\n      if (result.valid) {\r\n        continue;\r\n      }\r\n      const targets = this.interestingElements(elements);\r\n      if (targets.length) {\r\n        this.errorsInternal.push({ error: result, targets });\r\n      }\r\n    }\r\n\r\n    this.sort();\r\n    this.errors = this.errorsInternal;\r\n  }\r\n\r\n  public bind() {\r\n    if (!this.controller) {\r\n      this.controller = this.controllerAccessor();\r\n    }\r\n    // this will call render() with the side-effect of updating this.errors\r\n    this.controller.addRenderer(this);\r\n  }\r\n\r\n  public unbind() {\r\n    if (this.controller) {\r\n      this.controller.removeRenderer(this);\r\n    }\r\n  }\r\n}\r\n","import { ValidationController } from './validation-controller';\r\nimport { ValidationRenderer } from './validation-renderer';\r\nimport { customAttribute } from 'aurelia-templating';\r\n\r\n@customAttribute('validation-renderer')\r\nexport class ValidationRendererCustomAttribute {\r\n\r\n  private container: any;\r\n  private controller: ValidationController;\r\n  private value: string;\r\n  private renderer: ValidationRenderer;\r\n\r\n  public created(view: any) {\r\n    this.container = view.container;\r\n  }\r\n\r\n  public bind() {\r\n    this.controller = this.container.get(ValidationController);\r\n    this.renderer = this.container.get(this.value);\r\n    this.controller.addRenderer(this.renderer);\r\n  }\r\n\r\n  public unbind() {\r\n    this.controller.removeRenderer(this.renderer);\r\n    this.controller = null as any;\r\n    this.renderer = null as any;\r\n  }\r\n}\r\n","import { Rule, RuleProperty, ValidationDisplayNameAccessor } from './rule';\r\nimport { ValidationMessageParser } from './validation-message-parser';\r\nimport { Rules } from './rules';\r\nimport { validationMessages } from './validation-messages';\r\nimport { PropertyAccessorParser, PropertyAccessor } from '../property-accessor-parser';\r\nimport { isString } from '../util';\r\n\r\n/**\r\n * Part of the fluent rule API. Enables customizing property rules.\r\n */\r\nexport class FluentRuleCustomizer<TObject, TValue> {\r\n  private rule: Rule<TObject, TValue>;\r\n\r\n  constructor(\r\n    property: RuleProperty,\r\n    condition: (value: TValue, object?: TObject) => boolean | Promise<boolean>,\r\n    config: object = {},\r\n    private fluentEnsure: FluentEnsure<TObject>,\r\n    private fluentRules: FluentRules<TObject, TValue>,\r\n    private parsers: Parsers\r\n  ) {\r\n    this.rule = {\r\n      property,\r\n      condition,\r\n      config,\r\n      when: null,\r\n      messageKey: 'default',\r\n      message: null,\r\n      sequence: fluentRules.sequence\r\n    };\r\n    this.fluentEnsure._addRule(this.rule);\r\n  }\r\n\r\n  /**\r\n   * Validate subsequent rules after previously declared rules have\r\n   * been validated successfully. Use to postpone validation of costly\r\n   * rules until less expensive rules pass validation.\r\n   */\r\n  public then() {\r\n    this.fluentRules.sequence++;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies the key to use when looking up the rule's validation message.\r\n   */\r\n  public withMessageKey(key: string) {\r\n    this.rule.messageKey = key;\r\n    this.rule.message = null;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies rule's validation message.\r\n   */\r\n  public withMessage(message: string) {\r\n    this.rule.messageKey = 'custom';\r\n    this.rule.message = this.parsers.message.parse(message);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies a condition that must be met before attempting to validate the rule.\r\n   * @param condition A function that accepts the object as a parameter and returns true\r\n   * or false whether the rule should be evaluated.\r\n   */\r\n  public when(condition: (object: TObject) => boolean) {\r\n    this.rule.when = condition;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Tags the rule instance, enabling the rule to be found easily\r\n   * using ValidationRules.taggedRules(rules, tag)\r\n   */\r\n  public tag(tag: string) {\r\n    this.rule.tag = tag;\r\n    return this;\r\n  }\r\n\r\n  ///// FluentEnsure APIs /////\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor function.\r\n   */\r\n  public ensure<TValue2>(subject: string | ((model: TObject) => TValue2)) {\r\n    return this.fluentEnsure.ensure<TValue2>(subject);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public ensureObject() {\r\n    return this.fluentEnsure.ensureObject();\r\n  }\r\n\r\n  /**\r\n   * Rules that have been defined using the fluent API.\r\n   */\r\n  public get rules() {\r\n    return this.fluentEnsure.rules;\r\n  }\r\n\r\n  /**\r\n   * Applies the rules to a class or object, making them discoverable by the StandardValidator.\r\n   * @param target A class or object.\r\n   */\r\n  public on(target: any) {\r\n    return this.fluentEnsure.on(target);\r\n  }\r\n\r\n  ///////// FluentRules APIs /////////\r\n\r\n  /**\r\n   * Applies an ad-hoc rule function to the ensured property or object.\r\n   * @param condition The function to validate the rule.\r\n   * Will be called with two arguments, the property value and the object.\r\n   * Should return a boolean or a Promise that resolves to a boolean.\r\n   */\r\n  public satisfies(condition: (value: TValue, object: TObject) => boolean | Promise<boolean>, config?: object) {\r\n    return this.fluentRules.satisfies(condition, config);\r\n  }\r\n\r\n  /**\r\n   * Applies a rule by name.\r\n   * @param name The name of the custom or standard rule.\r\n   * @param args The rule's arguments.\r\n   */\r\n  public satisfiesRule(name: string, ...args: any[]) {\r\n    return this.fluentRules.satisfiesRule(name, ...args);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"required\" rule to the property.\r\n   * The value cannot be null, undefined or whitespace.\r\n   */\r\n  public required() {\r\n    return this.fluentRules.required();\r\n  }\r\n\r\n  /**\r\n   * Applies the \"matches\" rule to the property.\r\n   * Value must match the specified regular expression.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public matches(regex: RegExp) {\r\n    return this.fluentRules.matches(regex);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"email\" rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public email() {\r\n    return this.fluentRules.email();\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public minLength(length: number) {\r\n    return this.fluentRules.minLength(length);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public maxLength(length: number) {\r\n    return this.fluentRules.maxLength(length);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public minItems(count: number) {\r\n    return this.fluentRules.minItems(count);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public maxItems(count: number) {\r\n    return this.fluentRules.maxItems(count);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"min\" NUMBER validation rule to the property.\r\n   * Value must be greater than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public min(value: number) {\r\n    return this.fluentRules.min(value);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"max\" NUMBER validation rule to the property.\r\n   * Value must be less than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public max(value: number) {\r\n    return this.fluentRules.max(value);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"range\" NUMBER validation rule to the property.\r\n   * Value must be between or equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public range(min: number, max: number) {\r\n    return this.fluentRules.range(min, max);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"between\" NUMBER validation rule to the property.\r\n   * Value must be between but not equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public between(min: number, max: number) {\r\n    return this.fluentRules.between(min, max);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"equals\" validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public equals(expectedValue: TValue) {\r\n    return this.fluentRules.equals(expectedValue);\r\n  }\r\n}\r\n\r\n/**\r\n * Part of the fluent rule API. Enables applying rules to properties and objects.\r\n */\r\nexport class FluentRules<TObject, TValue> {\r\n  public static customRules: {\r\n    [name: string]: {\r\n      condition: (value: any, object?: any, ...fluentArgs: any[]) => boolean | Promise<boolean>;\r\n      argsToConfig?: (...args: any[]) => any;\r\n    }\r\n  } = {};\r\n\r\n  /**\r\n   * Current rule sequence number. Used to postpone evaluation of rules until rules\r\n   * with lower sequence number have successfully validated. The \"then\" fluent API method\r\n   * manages this property, there's usually no need to set it directly.\r\n   */\r\n  public sequence = 0;\r\n\r\n  constructor(\r\n    private fluentEnsure: FluentEnsure<TObject>,\r\n    private parsers: Parsers,\r\n    private property: RuleProperty\r\n  ) { }\r\n\r\n  /**\r\n   * Sets the display name of the ensured property.\r\n   */\r\n  public displayName(name: string | ValidationDisplayNameAccessor | null) {\r\n    this.property.displayName = name;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies an ad-hoc rule function to the ensured property or object.\r\n   * @param condition The function to validate the rule.\r\n   * Will be called with two arguments, the property value and the object.\r\n   * Should return a boolean or a Promise that resolves to a boolean.\r\n   */\r\n  public satisfies(condition: (value: TValue, object?: TObject) => boolean | Promise<boolean>, config?: object) {\r\n    return new FluentRuleCustomizer<TObject, TValue>(\r\n      this.property, condition, config, this.fluentEnsure, this, this.parsers);\r\n  }\r\n\r\n  /**\r\n   * Applies a rule by name.\r\n   * @param name The name of the custom or standard rule.\r\n   * @param args The rule's arguments.\r\n   */\r\n  public satisfiesRule(name: string, ...args: any[]): FluentRuleCustomizer<TObject, TValue> {\r\n    let rule = FluentRules.customRules[name];\r\n    if (!rule) {\r\n      // standard rule?\r\n      rule = (this as any)[name];\r\n      if (rule instanceof Function) {\r\n        return rule.call(this, ...args);\r\n      }\r\n      throw new Error(`Rule with name \"${name}\" does not exist.`);\r\n    }\r\n    const config = rule.argsToConfig ? rule.argsToConfig(...args) : undefined;\r\n    return this.satisfies((value, obj) => rule.condition.call(this, value, obj, ...args), config)\r\n      .withMessageKey(name);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"required\" rule to the property.\r\n   * The value cannot be null, undefined or whitespace.\r\n   */\r\n  public required() {\r\n    return this.satisfies(\r\n      value =>\r\n        value !== null\r\n        && value !== undefined\r\n        && !(isString(value) && !/\\S/.test(value as any))\r\n    ).withMessageKey('required');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"matches\" rule to the property.\r\n   * Value must match the specified regular expression.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public matches(regex: RegExp) {\r\n    return this.satisfies(\r\n      value => value === null || value === undefined || (value as any).length === 0 || regex.test(value as any))\r\n      .withMessageKey('matches');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"email\" rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public email() {\r\n    // regex from https://html.spec.whatwg.org/multipage/forms.html#valid-e-mail-address\r\n    /* tslint:disable:max-line-length */\r\n    return this.matches(/^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)\r\n      /* tslint:enable:max-line-length */\r\n      .withMessageKey('email');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public minLength(length: number) {\r\n    return this.satisfies(\r\n      (value: any) => value === null || value === undefined || value.length === 0 || value.length >= length,\r\n      { length })\r\n      .withMessageKey('minLength');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public maxLength(length: number) {\r\n    return this.satisfies(\r\n      (value: any) => value === null || value === undefined || value.length === 0 || value.length <= length,\r\n      { length })\r\n      .withMessageKey('maxLength');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public minItems(count: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value.length >= count, { count })\r\n      .withMessageKey('minItems');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public maxItems(count: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value.length <= count, { count })\r\n      .withMessageKey('maxItems');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"min\" NUMBER validation rule to the property.\r\n   * Value must be greater than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public min(constraint: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value >= constraint, { constraint })\r\n      .withMessageKey('min');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"max\" NUMBER validation rule to the property.\r\n   * Value must be less than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public max(constraint: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value <= constraint, { constraint })\r\n      .withMessageKey('max');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"range\" NUMBER validation rule to the property.\r\n   * Value must be between or equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public range(min: number, max: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || (value >= min && value <= max),\r\n      { min, max })\r\n      .withMessageKey('range');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"between\" NUMBER validation rule to the property.\r\n   * Value must be between but not equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public between(min: number, max: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || (value > min && value < max),\r\n      { min, max })\r\n      .withMessageKey('between');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"equals\" validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public equals(expectedValue: TValue) {\r\n    return this.satisfies(\r\n      value => value === null || value === undefined || value as any === '' || value === expectedValue,\r\n      { expectedValue })\r\n      .withMessageKey('equals');\r\n  }\r\n}\r\n\r\n/**\r\n * Part of the fluent rule API. Enables targeting properties and objects with rules.\r\n */\r\nexport class FluentEnsure<TObject> {\r\n  /**\r\n   * Rules that have been defined using the fluent API.\r\n   */\r\n  public rules: Rule<TObject, any>[][] = [];\r\n\r\n  constructor(private parsers: Parsers) { }\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor\r\n   * function.\r\n   */\r\n  public ensure<TValue>(property: string | number | PropertyAccessor<TObject, TValue>): FluentRules<TObject, any> {\r\n    this.assertInitialized();\r\n    const name = this.parsers.property.parse(property);\r\n    const fluentRules = new FluentRules<TObject, TValue>(\r\n      this,\r\n      this.parsers,\r\n      { name, displayName: null });\r\n    return this.mergeRules(fluentRules, name);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public ensureObject(): FluentRules<TObject, any> {\r\n    this.assertInitialized();\r\n    const fluentRules = new FluentRules<TObject, TObject>(\r\n      this, this.parsers, { name: null, displayName: null });\r\n    return this.mergeRules(fluentRules, null);\r\n  }\r\n\r\n  /**\r\n   * Applies the rules to a class or object, making them discoverable by the StandardValidator.\r\n   * @param target A class or object.\r\n   */\r\n  public on(target: any) {\r\n    Rules.set(target, this.rules);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a rule definition to the sequenced ruleset.\r\n   * @internal\r\n   */\r\n  public _addRule(rule: Rule<TObject, any>) {\r\n    while (this.rules.length < rule.sequence + 1) {\r\n      this.rules.push([]);\r\n    }\r\n    this.rules[rule.sequence].push(rule);\r\n  }\r\n\r\n  private assertInitialized() {\r\n    if (this.parsers) {\r\n      return;\r\n    }\r\n    throw new Error(`Did you forget to add \".plugin('aurelia-validation')\" to your main.js?`);\r\n  }\r\n\r\n  private mergeRules(fluentRules: FluentRules<TObject, any>, propertyName: string | number | null) {\r\n    // tslint:disable-next-line:triple-equals | Use loose equality for property keys\r\n    const existingRules = this.rules.find(r => r.length > 0 && r[0].property.name == propertyName);\r\n    if (existingRules) {\r\n      const rule = existingRules[existingRules.length - 1];\r\n      fluentRules.sequence = rule.sequence;\r\n      if (rule.property.displayName !== null) {\r\n        fluentRules = fluentRules.displayName(rule.property.displayName);\r\n      }\r\n    }\r\n    return fluentRules;\r\n  }\r\n}\r\n\r\n/**\r\n * Fluent rule definition API.\r\n */\r\nexport class ValidationRules {\r\n  private static parsers: Parsers;\r\n\r\n  public static initialize(messageParser: ValidationMessageParser, propertyParser: PropertyAccessorParser) {\r\n    this.parsers = {\r\n      message: messageParser,\r\n      property: propertyParser\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor function.\r\n   */\r\n  public static ensure<TObject, TValue>(property: string | number | PropertyAccessor<TObject, TValue>) {\r\n    return new FluentEnsure<TObject>(ValidationRules.parsers).ensure(property);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public static ensureObject<TObject>() {\r\n    return new FluentEnsure<TObject>(ValidationRules.parsers).ensureObject();\r\n  }\r\n\r\n  /**\r\n   * Defines a custom rule.\r\n   * @param name The name of the custom rule. Also serves as the message key.\r\n   * @param condition The rule function.\r\n   * @param message The message expression\r\n   * @param argsToConfig A function that maps the rule's arguments to a \"config\"\r\n   * object that can be used when evaluating the message expression.\r\n   */\r\n  public static customRule(\r\n    name: string,\r\n    condition: (value: any, object?: any, ...args: any[]) => boolean | Promise<boolean>,\r\n    message: string,\r\n    argsToConfig?: (...args: any[]) => any\r\n  ) {\r\n    validationMessages[name] = message;\r\n    FluentRules.customRules[name] = { condition, argsToConfig };\r\n  }\r\n\r\n  /**\r\n   * Returns rules with the matching tag.\r\n   * @param rules The rules to search.\r\n   * @param tag The tag to search for.\r\n   */\r\n  public static taggedRules(rules: Rule<any, any>[][], tag: string): Rule<any, any>[][] {\r\n    return rules.map(x => x.filter(r => r.tag === tag));\r\n  }\r\n\r\n  /**\r\n   * Returns rules that have no tag.\r\n   * @param rules The rules to search.\r\n   */\r\n  public static untaggedRules(rules: Rule<any, any>[][]): Rule<any, any>[][] {\r\n    return rules.map(x => x.filter(r => r.tag === undefined));\r\n  }\r\n\r\n  /**\r\n   * Removes the rules from a class or object.\r\n   * @param target A class or object.\r\n   */\r\n  public static off(target: any): void {\r\n    Rules.unset(target);\r\n  }\r\n}\r\n\r\nexport interface Parsers {\r\n  message: ValidationMessageParser;\r\n  property: PropertyAccessorParser;\r\n}\r\n","// Exports\r\n\r\nexport * from './config';\r\nexport * from './controller-validate-result';\r\nexport * from './get-target-dom-element';\r\nexport * from './property-info';\r\nexport * from './property-accessor-parser';\r\nexport * from './validate-binding-behavior';\r\nexport * from './validate-event';\r\nexport * from './validate-instruction';\r\nexport * from './validate-result';\r\nexport * from './validate-trigger';\r\nexport * from './validation-controller';\r\nexport * from './validation-controller-factory';\r\nexport * from './validation-errors-custom-attribute';\r\nexport * from './validation-renderer-custom-attribute';\r\nexport * from './validation-renderer';\r\nexport * from './validator';\r\n\r\nexport * from './implementation/rule';\r\nexport * from './implementation/rules';\r\nexport * from './implementation/standard-validator';\r\nexport * from './implementation/validation-messages';\r\nexport * from './implementation/validation-message-parser';\r\nexport * from './implementation/validation-rules';\r\n\r\n// Configuration\r\n\r\nimport { Container } from 'aurelia-dependency-injection';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { ValidationMessageParser } from './implementation/validation-message-parser';\r\nimport { PropertyAccessorParser } from './property-accessor-parser';\r\nimport { ValidationRules } from './implementation/validation-rules';\r\nimport {\r\n  ValidateBindingBehavior,\r\n  ValidateManuallyBindingBehavior,\r\n  ValidateOnBlurBindingBehavior,\r\n  ValidateOnChangeBindingBehavior,\r\n  ValidateOnChangeOrBlurBindingBehavior,\r\n  ValidateOnFocusoutBindingBehavior,\r\n  ValidateOnChangeOrFocusoutBindingBehavior\r\n} from './validate-binding-behavior';\r\nimport { ValidationErrorsCustomAttribute } from './validation-errors-custom-attribute';\r\nimport { ValidationRendererCustomAttribute } from './validation-renderer-custom-attribute';\r\n\r\n/**\r\n * Configures the plugin.\r\n */\r\nexport function configure(\r\n  // tslint:disable-next-line:ban-types\r\n  frameworkConfig: { container: Container, globalResources?: (...resources: any[]) => any },\r\n  callback?: (config: GlobalValidationConfiguration) => void\r\n) {\r\n  // the fluent rule definition API needs the parser to translate messages\r\n  // to interpolation expressions.\r\n  const messageParser = frameworkConfig.container.get(ValidationMessageParser);\r\n  const propertyParser = frameworkConfig.container.get(PropertyAccessorParser);\r\n  ValidationRules.initialize(messageParser, propertyParser);\r\n\r\n  // configure...\r\n  const config = new GlobalValidationConfiguration();\r\n  if (callback instanceof Function) {\r\n    callback(config);\r\n  }\r\n  config.apply(frameworkConfig.container);\r\n\r\n  // globalize the behaviors.\r\n  if (frameworkConfig.globalResources) {\r\n    frameworkConfig.globalResources(\r\n      ValidateBindingBehavior,\r\n      ValidateManuallyBindingBehavior,\r\n      ValidateOnBlurBindingBehavior,\r\n      ValidateOnFocusoutBindingBehavior,\r\n      ValidateOnChangeBindingBehavior,\r\n      ValidateOnChangeOrBlurBindingBehavior,\r\n      ValidateOnChangeOrFocusoutBindingBehavior,\r\n      ValidationErrorsCustomAttribute,\r\n      ValidationRendererCustomAttribute);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}