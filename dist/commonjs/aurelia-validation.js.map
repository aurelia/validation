{"version":3,"file":"aurelia-validation.js","sources":["../../src/validator.ts","../../src/validate-result.ts","../../src/implementation/rules.ts","../../src/implementation/expression-visitor.ts","../../src/implementation/validation-message-parser.ts","../../src/implementation/validation-messages.ts","../../src/implementation/standard-validator.ts","../../src/validate-trigger.ts","../../src/config.ts","../../src/get-target-dom-element.ts","../../src/property-info.ts","../../src/util.ts","../../src/property-accessor-parser.ts","../../src/validate-event.ts","../../src/validation-controller.ts","../../src/validate-binding-behavior-base.ts","../../src/validate-binding-behavior.ts","../../src/validation-controller-factory.ts","../../src/validation-errors-custom-attribute.ts","../../src/validation-renderer-custom-attribute.ts","../../src/implementation/validation-rules.ts","../../src/aurelia-validation.ts"],"sourcesContent":["import { ValidateResult } from './validate-result';\r\n\r\n/**\r\n * Validates objects and properties.\r\n */\r\nexport abstract class Validator {\r\n  /**\r\n   * Validates the specified property.\r\n   * @param object The object to validate.\r\n   * @param propertyName The name of the property to validate.\r\n   * @param rules Optional. If unspecified, the implementation should lookup the rules for the\r\n   * specified object. This may not be possible for all implementations of this interface.\r\n   */\r\n  public abstract validateProperty(object: any, propertyName: string, rules?: any): Promise<ValidateResult[]>;\r\n\r\n  /**\r\n   * Validates all rules for specified object and it's properties.\r\n   * @param object The object to validate.\r\n   * @param rules Optional. If unspecified, the implementation should lookup the rules for the\r\n   * specified object. This may not be possible for all implementations of this interface.\r\n   */\r\n  public abstract validateObject(object: any, rules?: any): Promise<ValidateResult[]>;\r\n\r\n  /**\r\n   * Determines whether a rule exists in a set of rules.\r\n   * @param rules The rules to search.\r\n   * @parem rule The rule to find.\r\n   */\r\n  public abstract ruleExists(rules: any, rule: any): boolean;\r\n}\r\n","/**\r\n * The result of validating an individual validation rule.\r\n */\r\nexport class ValidateResult {\r\n  private static nextId = 0;\r\n\r\n  /**\r\n   * A number that uniquely identifies the result instance.\r\n   */\r\n  public id: number;\r\n\r\n  /**\r\n   * @param rule The rule associated with the result. Validator implementation specific.\r\n   * @param object The object that was validated.\r\n   * @param propertyName The name of the property that was validated.\r\n   * @param error The error, if the result is a validation error.\r\n   */\r\n  constructor(\r\n    public rule: any,\r\n    public object: any,\r\n    public propertyName: string | number | null,\r\n    public valid: boolean,\r\n    public message: string | null = null\r\n  ) {\r\n    this.id = ValidateResult.nextId++;\r\n  }\r\n\r\n  public toString() {\r\n    return this.valid ? 'Valid.' : this.message;\r\n  }\r\n}\r\n","import { Rule } from './rule';\r\n\r\n/**\r\n * Sets, unsets and retrieves rules on an object or constructor function.\r\n */\r\nexport class Rules {\r\n  /**\r\n   * The name of the property that stores the rules.\r\n   */\r\n  private static key = '__rules__';\r\n\r\n  /**\r\n   * Applies the rules to a target.\r\n   */\r\n  public static set(target: any, rules: Rule<any, any>[][]): void {\r\n    if (target instanceof Function) {\r\n      target = target.prototype;\r\n    }\r\n    Object.defineProperty(\r\n      target,\r\n      Rules.key,\r\n      { enumerable: false, configurable: false, writable: true, value: rules });\r\n  }\r\n\r\n  /**\r\n   * Removes rules from a target.\r\n   */\r\n  public static unset(target: any): void {\r\n    if (target instanceof Function) {\r\n      target = target.prototype;\r\n    }\r\n    target[Rules.key] = null;\r\n  }\r\n\r\n  /**\r\n   * Retrieves the target's rules.\r\n   */\r\n  public static get(target: any): Rule<any, any>[][] | null {\r\n    return target[Rules.key] || null;\r\n  }\r\n}\r\n","import {\r\n  Expression,\r\n  ValueConverter,\r\n  Conditional,\r\n  AccessScope,\r\n  AccessMember,\r\n  AccessKeyed,\r\n  CallMember,\r\n  BindingBehavior,\r\n  Binary,\r\n  LiteralPrimitive,\r\n  LiteralString\r\n} from 'aurelia-binding';\r\n\r\n// tslint:disable:no-empty\r\nexport class ExpressionVisitor {\r\n  public visitChain(chain: any) {\r\n    this.visitArgs(chain.expressions);\r\n  }\r\n\r\n  public visitBindingBehavior(behavior: BindingBehavior) {\r\n    behavior.expression.accept(this);\r\n    this.visitArgs(behavior.args);\r\n  }\r\n\r\n  public visitValueConverter(converter: ValueConverter) {\r\n    converter.expression.accept(this);\r\n    this.visitArgs(converter.args);\r\n  }\r\n\r\n  public visitAssign(assign: any) {\r\n    assign.target.accept(this);\r\n    assign.value.accept(this);\r\n  }\r\n\r\n  public visitConditional(conditional: Conditional) {\r\n    conditional.condition.accept(this);\r\n    conditional.yes.accept(this);\r\n    conditional.no.accept(this);\r\n  }\r\n\r\n  public visitAccessThis(access: any) {\r\n    access.ancestor = access.ancestor;\r\n  }\r\n\r\n  public visitAccessScope(access: AccessScope) {\r\n    access.name = access.name;\r\n  }\r\n\r\n  public visitAccessMember(access: AccessMember) {\r\n    access.object.accept(this);\r\n  }\r\n\r\n  public visitAccessKeyed(access: AccessKeyed) {\r\n    access.object.accept(this);\r\n    access.key.accept(this);\r\n  }\r\n\r\n  public visitCallScope(call: any) {\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitCallFunction(call: any) {\r\n    call.func.accept(this);\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitCallMember(call: CallMember) {\r\n    call.object.accept(this);\r\n    this.visitArgs(call.args);\r\n  }\r\n\r\n  public visitPrefix(prefix: any) {\r\n    prefix.expression.accept(this);\r\n  }\r\n\r\n  public visitBinary(binary: Binary) {\r\n    binary.left.accept(this);\r\n    binary.right.accept(this);\r\n  }\r\n\r\n  public visitLiteralPrimitive(literal: LiteralPrimitive) {\r\n    literal.value = literal.value;\r\n  }\r\n\r\n  public visitLiteralArray(literal: any) {\r\n    this.visitArgs(literal.elements);\r\n  }\r\n\r\n  public visitLiteralObject(literal: any) {\r\n    this.visitArgs(literal.values);\r\n  }\r\n\r\n  public visitLiteralString(literal: LiteralString) {\r\n    literal.value = literal.value;\r\n  }\r\n\r\n  private visitArgs(args: Expression[]) {\r\n    for (let i = 0; i < args.length; i++) {\r\n      args[i].accept(this);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Expression,\r\n  AccessScope,\r\n  LiteralString,\r\n  Binary,\r\n  Conditional,\r\n  LiteralPrimitive,\r\n  CallMember\r\n} from 'aurelia-binding';\r\nimport { BindingLanguage } from 'aurelia-templating';\r\nimport * as LogManager from 'aurelia-logging';\r\nimport { ExpressionVisitor } from './expression-visitor';\r\n\r\nexport class ValidationMessageParser {\r\n  public static inject = [BindingLanguage];\r\n\r\n  private emptyStringExpression = new LiteralString('');\r\n  private nullExpression = new LiteralPrimitive(null);\r\n  private undefinedExpression = new LiteralPrimitive(undefined);\r\n  private cache: { [message: string]: Expression } = {};\r\n\r\n  constructor(private bindinqLanguage: BindingLanguage) { }\r\n\r\n  public parse(message: string): Expression {\r\n    if (this.cache[message] !== undefined) {\r\n      return this.cache[message];\r\n    }\r\n\r\n    const parts: (Expression | string)[] | null = (this.bindinqLanguage as any).parseInterpolation(null, message);\r\n    if (parts === null) {\r\n      return new LiteralString(message);\r\n    }\r\n    let expression: Expression = new LiteralString(parts[0] as string);\r\n    for (let i = 1; i < parts.length; i += 2) {\r\n      expression = new Binary(\r\n        '+',\r\n        expression,\r\n        new Binary(\r\n          '+',\r\n          this.coalesce(parts[i] as Expression),\r\n          new LiteralString(parts[i + 1] as string)\r\n        )\r\n      );\r\n    }\r\n\r\n    MessageExpressionValidator.validate(expression, message);\r\n\r\n    this.cache[message] = expression;\r\n\r\n    return expression;\r\n  }\r\n\r\n  private coalesce(part: Expression): Expression {\r\n    // part === null || part === undefined ? '' : part\r\n    return new Conditional(\r\n      new Binary(\r\n        '||',\r\n        new Binary('===', part, this.nullExpression),\r\n        new Binary('===', part, this.undefinedExpression)\r\n      ),\r\n      this.emptyStringExpression,\r\n      new CallMember(part, 'toString', [])\r\n    );\r\n  }\r\n}\r\n\r\nexport class MessageExpressionValidator extends ExpressionVisitor {\r\n  public static validate(expression: Expression, originalMessage: string) {\r\n    const visitor = new MessageExpressionValidator(originalMessage);\r\n    expression.accept(visitor);\r\n  }\r\n\r\n  constructor(private originalMessage: string) {\r\n    super();\r\n  }\r\n\r\n  public visitAccessScope(access: AccessScope) {\r\n    if (access.ancestor !== 0) {\r\n      throw new Error('$parent is not permitted in validation message expressions.');\r\n    }\r\n    if (['displayName', 'propertyName', 'value', 'object', 'config', 'getDisplayName'].indexOf(access.name) !== -1) {\r\n      LogManager.getLogger('aurelia-validation')\r\n        // tslint:disable-next-line:max-line-length\r\n        .warn(`Did you mean to use \"$${access.name}\" instead of \"${access.name}\" in this validation message template: \"${this.originalMessage}\"?`);\r\n    }\r\n  }\r\n}\r\n","import { Expression } from 'aurelia-binding';\r\nimport { ValidationMessageParser } from './validation-message-parser';\r\n\r\nexport interface ValidationMessages {\r\n  [key: string]: string;\r\n}\r\n\r\n/**\r\n * Dictionary of validation messages. [messageKey]: messageExpression\r\n */\r\nexport const validationMessages: ValidationMessages = {\r\n  /**\r\n   * The default validation message. Used with rules that have no standard message.\r\n   */\r\n  default: `\\${$displayName} is invalid.`,\r\n  required: `\\${$displayName} is required.`,\r\n  matches: `\\${$displayName} is not correctly formatted.`,\r\n  email: `\\${$displayName} is not a valid email.`,\r\n  minLength: `\\${$displayName} must be at least \\${$config.length} character\\${$config.length === 1 ? '' : 's'}.`,\r\n  maxLength: `\\${$displayName} cannot be longer than \\${$config.length} character\\${$config.length === 1 ? '' : 's'}.`,\r\n  minItems: `\\${$displayName} must contain at least \\${$config.count} item\\${$config.count === 1 ? '' : 's'}.`,\r\n  maxItems: `\\${$displayName} cannot contain more than \\${$config.count} item\\${$config.count === 1 ? '' : 's'}.`,\r\n  min: `\\${$displayName} must be at least \\${$config.constraint}.`,\r\n  max: `\\${$displayName} must be at most \\${$config.constraint}.`,\r\n  range: `\\${$displayName} must be between or equal to \\${$config.min} and \\${$config.max}.`,\r\n  between: `\\${$displayName} must be between but not equal to \\${$config.min} and \\${$config.max}.`,\r\n  equals: `\\${$displayName} must be \\${$config.expectedValue}.`,\r\n};\r\n\r\n/**\r\n * Retrieves validation messages and property display names.\r\n */\r\nexport class ValidationMessageProvider {\r\n  public static inject = [ValidationMessageParser];\r\n\r\n  constructor(public parser: ValidationMessageParser) { }\r\n\r\n  /**\r\n   * Returns a message binding expression that corresponds to the key.\r\n   * @param key The message key.\r\n   */\r\n  public getMessage(key: string): Expression {\r\n    let message: string;\r\n    if (key in validationMessages) {\r\n      message = validationMessages[key];\r\n    } else {\r\n      message = validationMessages['default'];\r\n    }\r\n    return this.parser.parse(message);\r\n  }\r\n\r\n  /**\r\n   * Formulates a property display name using the property name and the configured\r\n   * displayName (if provided).\r\n   * Override this with your own custom logic.\r\n   * @param propertyName The property name.\r\n   */\r\n  public getDisplayName(propertyName: string | number, displayName?: string | null | (() => string)): string {\r\n    if (displayName !== null && displayName !== undefined) {\r\n      return (displayName instanceof Function) ? displayName() : displayName as string;\r\n    }\r\n\r\n    // split on upper-case letters.\r\n    const words = propertyName.toString().split(/(?=[A-Z])/).join(' ');\r\n    // capitalize first letter.\r\n    return words.charAt(0).toUpperCase() + words.slice(1);\r\n  }\r\n}\r\n","import { Expression, LookupFunctions } from 'aurelia-binding';\r\nimport { ViewResources } from 'aurelia-templating';\r\nimport { Validator } from '../validator';\r\nimport { ValidateResult } from '../validate-result';\r\nimport { Rule } from './rule';\r\nimport { Rules } from './rules';\r\nimport { ValidationMessageProvider } from './validation-messages';\r\n\r\n/**\r\n * Validates.\r\n * Responsible for validating objects and properties.\r\n */\r\nexport class StandardValidator extends Validator {\r\n  public static inject = [ValidationMessageProvider, ViewResources];\r\n\r\n  private messageProvider: ValidationMessageProvider;\r\n  private lookupFunctions: LookupFunctions;\r\n  private getDisplayName: (propertyName: string) => string;\r\n\r\n  constructor(messageProvider: ValidationMessageProvider, resources: ViewResources) {\r\n    super();\r\n    this.messageProvider = messageProvider;\r\n    this.lookupFunctions = (resources as any).lookupFunctions;\r\n    this.getDisplayName = messageProvider.getDisplayName.bind(messageProvider);\r\n  }\r\n\r\n  /**\r\n   * Validates the specified property.\r\n   * @param object The object to validate.\r\n   * @param propertyName The name of the property to validate.\r\n   * @param rules Optional. If unspecified, the rules will be looked up using the metadata\r\n   * for the object created by ValidationRules....on(class/object)\r\n   */\r\n  public validateProperty(object: any, propertyName: string | number, rules?: any): Promise<ValidateResult[]> {\r\n    return this.validate(object, propertyName, rules || null);\r\n  }\r\n\r\n  /**\r\n   * Validates all rules for specified object and it's properties.\r\n   * @param object The object to validate.\r\n   * @param rules Optional. If unspecified, the rules will be looked up using the metadata\r\n   * for the object created by ValidationRules....on(class/object)\r\n   */\r\n  public validateObject(object: any, rules?: any): Promise<ValidateResult[]> {\r\n    return this.validate(object, null, rules || null);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a rule exists in a set of rules.\r\n   * @param rules The rules to search.\r\n   * @parem rule The rule to find.\r\n   */\r\n  public ruleExists(rules: Rule<any, any>[][], rule: Rule<any, any>): boolean {\r\n    let i = rules.length;\r\n    while (i--) {\r\n      if (rules[i].indexOf(rule) !== -1) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private getMessage(rule: Rule<any, any>, object: any, value: any): string {\r\n    const expression: Expression = rule.message || this.messageProvider.getMessage(rule.messageKey);\r\n    // tslint:disable-next-line:prefer-const\r\n    let { name: propertyName, displayName } = rule.property;\r\n    if (propertyName !== null) {\r\n      displayName = this.messageProvider.getDisplayName(propertyName, displayName);\r\n    }\r\n    const overrideContext: any = {\r\n      $displayName: displayName,\r\n      $propertyName: propertyName,\r\n      $value: value,\r\n      $object: object,\r\n      $config: rule.config,\r\n      // returns the name of a given property, given just the property name (irrespective of the property's displayName)\r\n      // split on capital letters, first letter ensured to be capitalized\r\n      $getDisplayName: this.getDisplayName\r\n    };\r\n    return expression.evaluate(\r\n      { bindingContext: object, overrideContext },\r\n      this.lookupFunctions);\r\n  }\r\n\r\n  private validateRuleSequence(\r\n    object: any,\r\n    propertyName: string | number | null,\r\n    ruleSequence: Rule<any, any>[][],\r\n    sequence: number,\r\n    results: ValidateResult[]\r\n  ): Promise<ValidateResult[]> {\r\n    // are we validating all properties or a single property?\r\n    const validateAllProperties = propertyName === null || propertyName === undefined;\r\n\r\n    const rules = ruleSequence[sequence];\r\n    let allValid = true;\r\n\r\n    // validate each rule.\r\n    const promises: Promise<boolean>[] = [];\r\n    for (let i = 0; i < rules.length; i++) {\r\n      const rule = rules[i];\r\n\r\n      // is the rule related to the property we're validating.\r\n      // tslint:disable-next-line:triple-equals | Use loose equality for property keys\r\n      if (!validateAllProperties && rule.property.name != propertyName) {\r\n        continue;\r\n      }\r\n\r\n      // is this a conditional rule? is the condition met?\r\n      if (rule.when && !rule.when(object)) {\r\n        continue;\r\n      }\r\n\r\n      // validate.\r\n      const value = rule.property.name === null ? object : object[rule.property.name];\r\n      let promiseOrBoolean = rule.condition(value, object);\r\n      if (!(promiseOrBoolean instanceof Promise)) {\r\n        promiseOrBoolean = Promise.resolve(promiseOrBoolean);\r\n      }\r\n      promises.push(promiseOrBoolean.then(valid => {\r\n          const message = valid ? null : this.getMessage(rule, object, value);\r\n          results.push(new ValidateResult(rule, object, rule.property.name, valid, message));\r\n          allValid = allValid && valid;\r\n          return valid;\r\n        }));\r\n    }\r\n\r\n    return Promise.all(promises)\r\n      .then(() => {\r\n      sequence++;\r\n      if (allValid && sequence < ruleSequence.length) {\r\n        return this.validateRuleSequence(object, propertyName, ruleSequence, sequence, results);\r\n      }\r\n      return results;\r\n    });\r\n  }\r\n\r\n  private validate(\r\n    object: any,\r\n    propertyName: string | number | null,\r\n    rules: Rule<any, any>[][] | null\r\n  ): Promise<ValidateResult[]> {\r\n    // rules specified?\r\n    if (!rules) {\r\n      // no. attempt to locate the rules.\r\n      rules = Rules.get(object);\r\n    }\r\n\r\n    // any rules?\r\n    if (!rules || rules.length === 0) {\r\n      return Promise.resolve([]);\r\n    }\r\n\r\n    return this.validateRuleSequence(object, propertyName, rules, 0, []);\r\n  }\r\n}\r\n","/**\r\n * Validation triggers.\r\n */\r\nexport enum validateTrigger {\r\n  /**\r\n   * Manual validation.  Use the controller's `validate()` and  `reset()` methods\r\n   * to validate all bindings.\r\n   */\r\n  manual = 0,           // 0x000\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"blur\" event.\r\n   */\r\n  blur = 1,             // 0x001\r\n\r\n  /**\r\n   * Validate the binding when it updates the model due to a change in the view.\r\n   */\r\n  change = 2,           // 0x010\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"blur\" event and\r\n   * when it updates the model due to a change in the view.\r\n   */\r\n  changeOrBlur = 3,     // 0x011\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"focusout\" event.\r\n   * Unlike \"blur\", this event bubbles.\r\n   */\r\n  focusout = 4,         // 0x100\r\n\r\n  /**\r\n   * Validate the binding when the binding's target element fires a DOM \"focusout\" event or\r\n   * when it updates the model due to a change in the view.\r\n   */\r\n  changeOrFocusout = 6, // 0x110\r\n}\r\n","import { Container } from 'aurelia-dependency-injection';\r\nimport { Validator } from './validator';\r\nimport { StandardValidator } from './implementation/standard-validator';\r\nimport { validateTrigger } from './validate-trigger';\r\n\r\nexport type ValidatorCtor = new (...args: any[]) => Validator;\r\n\r\n/**\r\n * Aurelia Validation Configuration API\r\n */\r\nexport class GlobalValidationConfiguration {\r\n  public static DEFAULT_VALIDATION_TRIGGER = validateTrigger.blur;\r\n\r\n  private validatorType: ValidatorCtor = StandardValidator;\r\n  private validationTrigger = GlobalValidationConfiguration.DEFAULT_VALIDATION_TRIGGER;\r\n\r\n  /**\r\n   * Use a custom Validator implementation.\r\n   */\r\n  public customValidator(type: ValidatorCtor) {\r\n    this.validatorType = type;\r\n    return this;\r\n  }\r\n\r\n  public defaultValidationTrigger(trigger: validateTrigger) {\r\n    this.validationTrigger = trigger;\r\n    return this;\r\n  }\r\n\r\n  public getDefaultValidationTrigger() {\r\n    return this.validationTrigger;\r\n  }\r\n\r\n  /**\r\n   * Applies the configuration.\r\n   */\r\n  public apply(container: Container) {\r\n    const validator = container.get(this.validatorType);\r\n    container.registerInstance(Validator, validator);\r\n    container.registerInstance(GlobalValidationConfiguration, this);\r\n  }\r\n}\r\n","import { DOM } from 'aurelia-pal';\r\n\r\n/**\r\n * Gets the DOM element associated with the data-binding. Most of the time it's\r\n * the binding.target but sometimes binding.target is an aurelia custom element,\r\n * or custom attribute which is a javascript \"class\" instance, so we need to use\r\n * the controller's container to retrieve the actual DOM element.\r\n */\r\nexport function getTargetDOMElement(binding: any, view: any): Element {\r\n  const target = binding.target;\r\n  // DOM element\r\n  if (target instanceof Element) {\r\n    return target;\r\n  }\r\n  // custom element or custom attribute\r\n  // tslint:disable-next-line:prefer-const\r\n  for (let i = 0, ii = view.controllers.length; i < ii; i++) {\r\n    const controller: any = view.controllers[i];\r\n    if (controller.viewModel === target) {\r\n      const element = controller.container.get(DOM.Element);\r\n      if (element) {\r\n        return element;\r\n      }\r\n      throw new Error(`Unable to locate target element for \"${binding.sourceExpression}\".`);\r\n    }\r\n  }\r\n  throw new Error(`Unable to locate target element for \"${binding.sourceExpression}\".`);\r\n}\r\n","import {\r\n  AccessMember,\r\n  AccessScope,\r\n  AccessKeyed,\r\n  BindingBehavior,\r\n  Expression,\r\n  ValueConverter,\r\n  Scope,\r\n  getContextFor\r\n} from 'aurelia-binding';\r\n\r\nfunction getObject(expression: Expression, objectExpression: Expression, source: any): null | undefined | object {\r\n  const value = objectExpression.evaluate(source, null as any);\r\n  if (value === null || value === undefined || value instanceof Object) {\r\n    return value;\r\n  }\r\n  // tslint:disable-next-line:max-line-length\r\n  throw new Error(`The '${objectExpression}' part of '${expression}' evaluates to ${value} instead of an object, null or undefined.`);\r\n}\r\n\r\n/**\r\n * Retrieves the object and property name for the specified expression.\r\n * @param expression The expression\r\n * @param source The scope\r\n */\r\nexport function getPropertyInfo(\r\n  expression: Expression,\r\n  source: Scope\r\n): { object: object; propertyName: string; } | null {\r\n  const originalExpression = expression;\r\n  while (expression instanceof BindingBehavior || expression instanceof ValueConverter) {\r\n    expression = expression.expression;\r\n  }\r\n\r\n  let object: null | undefined | object;\r\n  let propertyName: string;\r\n  if (expression instanceof AccessScope) {\r\n    object = getContextFor(expression.name, source, expression.ancestor);\r\n    propertyName = expression.name;\r\n  } else if (expression instanceof AccessMember) {\r\n    object = getObject(originalExpression, expression.object, source);\r\n    propertyName = expression.name;\r\n  } else if (expression instanceof AccessKeyed) {\r\n    object = getObject(originalExpression, expression.object, source);\r\n    propertyName = expression.key.evaluate(source);\r\n  } else {\r\n    throw new Error(`Expression '${originalExpression}' is not compatible with the validate binding-behavior.`);\r\n  }\r\n  if (object === null || object === undefined) {\r\n    return null;\r\n  }\r\n  return { object, propertyName };\r\n}\r\n","export function isString(value: any): boolean {\r\n  return Object.prototype.toString.call(value) === '[object String]';\r\n}\r\n\r\nexport function isNumber(value: any): boolean {\r\n  return Object.prototype.toString.call(value) === '[object Number]';\r\n}\r\n","import {\r\n  Parser,\r\n  AccessMember,\r\n  AccessScope\r\n} from 'aurelia-binding';\r\nimport { isString, isNumber } from './util';\r\n\r\nexport type PropertyAccessor<TObject, TValue> = (object: TObject) => TValue;\r\n\r\nexport class PropertyAccessorParser {\r\n  public static inject = [Parser];\r\n\r\n  constructor(private parser: Parser) { }\r\n\r\n  public parse<TObject, TValue>(property: string | number | PropertyAccessor<TObject, TValue>): string | number {\r\n    if (isString(property) || isNumber(property)) {\r\n      return property as string | number;\r\n    }\r\n    const accessorText = getAccessorExpression(property.toString());\r\n    const accessor = this.parser.parse(accessorText);\r\n    if (accessor instanceof AccessScope\r\n      || accessor instanceof AccessMember && accessor.object instanceof AccessScope) {\r\n      return accessor.name;\r\n    }\r\n    throw new Error(`Invalid property expression: \"${accessor}\"`);\r\n  }\r\n}\r\n\r\nexport function getAccessorExpression(fn: string): string {\r\n  /* tslint:disable:max-line-length */\r\n  const classic = /^function\\s*\\([$_\\w\\d]+\\)\\s*\\{(?:\\s*\"use strict\";)?(?:[$_\\s\\w\\d\\/\\*.['\"\\]+;\\(\\)]+)?\\s*return\\s+[$_\\w\\d]+\\.([$_\\w\\d]+)\\s*;?\\s*\\}$/;\r\n  /* tslint:enable:max-line-length */\r\n  const arrow = /^\\(?[$_\\w\\d]+\\)?\\s*=>\\s*[$_\\w\\d]+\\.([$_\\w\\d]+)$/;\r\n  const match = classic.exec(fn) || arrow.exec(fn);\r\n  if (match === null) {\r\n    throw new Error(`Unable to parse accessor function:\\n${fn}`);\r\n  }\r\n  return match[1];\r\n}\r\n","import { ValidateResult } from './validate-result';\r\nimport { ValidateInstruction } from './validate-instruction';\r\nimport { ControllerValidateResult } from './controller-validate-result';\r\n\r\nexport class ValidateEvent {\r\n  constructor(\r\n    /**\r\n     * The type of validate event. Either \"validate\" or \"reset\".\r\n     */\r\n    public readonly type: 'validate' | 'reset',\r\n\r\n    /**\r\n     * The controller's current array of errors. For an array containing both\r\n     * failed rules and passed rules, use the \"results\" property.\r\n     */\r\n    public readonly errors: ValidateResult[],\r\n\r\n    /**\r\n     * The controller's current array of validate results. This\r\n     * includes both passed rules and failed rules. For an array of only failed rules,\r\n     * use the \"errors\" property.\r\n     */\r\n    public readonly results: ValidateResult[],\r\n\r\n    /**\r\n     * The instruction passed to the \"validate\" or \"reset\" event. Will be null when\r\n     * the controller's validate/reset method was called with no instruction argument.\r\n     */\r\n    public readonly instruction: ValidateInstruction | null,\r\n\r\n    /**\r\n     * In events with type === \"validate\", this property will contain the result\r\n     * of validating the instruction (see \"instruction\" property). Use the controllerValidateResult\r\n     * to access the validate results specific to the call to \"validate\"\r\n     * (as opposed to using the \"results\" and \"errors\" properties to access the controller's entire\r\n     * set of results/errors).\r\n     */\r\n    public readonly controllerValidateResult: ControllerValidateResult | null\r\n\r\n  ) { }\r\n}\r\n","import { Binding, Expression } from 'aurelia-binding';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { Validator } from './validator';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { getPropertyInfo } from './property-info';\r\nimport { ValidationRenderer, RenderInstruction } from './validation-renderer';\r\nimport { ValidateResult } from './validate-result';\r\nimport { ValidateInstruction } from './validate-instruction';\r\nimport { ControllerValidateResult } from './controller-validate-result';\r\nimport { PropertyAccessorParser, PropertyAccessor } from './property-accessor-parser';\r\nimport { ValidateEvent } from './validate-event';\r\n\r\n/**\r\n * Orchestrates validation.\r\n * Manages a set of bindings, renderers and objects.\r\n * Exposes the current list of validation results for binding purposes.\r\n */\r\nexport class ValidationController {\r\n  public static inject = [Validator, PropertyAccessorParser, GlobalValidationConfiguration];\r\n\r\n  // Registered bindings (via the validate binding behavior)\r\n  private bindings = new Map<Binding, BindingInfo>();\r\n\r\n  // Renderers that have been added to the controller instance.\r\n  private renderers: ValidationRenderer[] = [];\r\n\r\n  /**\r\n   * Validation results that have been rendered by the controller.\r\n   */\r\n  private results: ValidateResult[] = [];\r\n\r\n  /**\r\n   * Validation errors that have been rendered by the controller.\r\n   */\r\n  public errors: ValidateResult[] = [];\r\n\r\n  /**\r\n   *  Whether the controller is currently validating.\r\n   */\r\n  public validating = false;\r\n\r\n  // Elements related to validation results that have been rendered.\r\n  private elements = new Map<ValidateResult, Element[]>();\r\n\r\n  // Objects that have been added to the controller instance (entity-style validation).\r\n  private objects = new Map<any, any>();\r\n\r\n  /**\r\n   * The trigger that will invoke automatic validation of a property used in a binding.\r\n   */\r\n  public validateTrigger: validateTrigger;\r\n\r\n  // Promise that resolves when validation has completed.\r\n  private finishValidating: Promise<any> = Promise.resolve();\r\n\r\n  private eventCallbacks: ((event: ValidateEvent) => void)[] = [];\r\n\r\n  constructor(\r\n    private validator: Validator,\r\n    private propertyParser: PropertyAccessorParser,\r\n    config?: GlobalValidationConfiguration,\r\n  ) {\r\n    this.validateTrigger = config instanceof GlobalValidationConfiguration\r\n        ? config.getDefaultValidationTrigger()\r\n        : GlobalValidationConfiguration.DEFAULT_VALIDATION_TRIGGER;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to controller validate and reset events. These events occur when the\r\n   * controller's \"validate\"\" and \"reset\" methods are called.\r\n   * @param callback The callback to be invoked when the controller validates or resets.\r\n   */\r\n  public subscribe(callback: (event: ValidateEvent) => void) {\r\n    this.eventCallbacks.push(callback);\r\n    return {\r\n      dispose: () => {\r\n        const index = this.eventCallbacks.indexOf(callback);\r\n        if (index === -1) {\r\n          return;\r\n        }\r\n        this.eventCallbacks.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Adds an object to the set of objects that should be validated when validate is called.\r\n   * @param object The object.\r\n   * @param rules Optional. The rules. If rules aren't supplied the Validator implementation will lookup the rules.\r\n   */\r\n  public addObject(object: any, rules?: any): void {\r\n    this.objects.set(object, rules);\r\n  }\r\n\r\n  /**\r\n   * Removes an object from the set of objects that should be validated when validate is called.\r\n   * @param object The object.\r\n   */\r\n  public removeObject(object: any): void {\r\n    this.objects.delete(object);\r\n    this.processResultDelta(\r\n      'reset',\r\n      this.results.filter(result => result.object === object),\r\n      []);\r\n  }\r\n\r\n  /**\r\n   * Adds and renders an error.\r\n   */\r\n  public addError<TObject>(\r\n    message: string,\r\n    object: TObject,\r\n    propertyName: string | PropertyAccessor<TObject, string> | null = null\r\n  ): ValidateResult {\r\n    let resolvedPropertyName: string | number | null;\r\n    if (propertyName === null) {\r\n      resolvedPropertyName = propertyName as any;\r\n    } else {\r\n      resolvedPropertyName = this.propertyParser.parse(propertyName);\r\n    }\r\n    const result = new ValidateResult({ __manuallyAdded__: true }, object, resolvedPropertyName, false, message);\r\n    this.processResultDelta('validate', [], [result]);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Removes and unrenders an error.\r\n   */\r\n  public removeError(result: ValidateResult) {\r\n    if (this.results.indexOf(result) !== -1) {\r\n      this.processResultDelta('reset', [result], []);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds a renderer.\r\n   * @param renderer The renderer.\r\n   */\r\n  public addRenderer(renderer: ValidationRenderer) {\r\n    this.renderers.push(renderer);\r\n    renderer.render({\r\n      kind: 'validate',\r\n      render: this.results.map(result => ({ result, elements: this.elements.get(result) as Element[] })),\r\n      unrender: []\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Removes a renderer.\r\n   * @param renderer The renderer.\r\n   */\r\n  public removeRenderer(renderer: ValidationRenderer) {\r\n    this.renderers.splice(this.renderers.indexOf(renderer), 1);\r\n    renderer.render({\r\n      kind: 'reset',\r\n      render: [],\r\n      unrender: this.results.map(result => ({ result, elements: this.elements.get(result) as Element[] }))\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Registers a binding with the controller.\r\n   * @param binding The binding instance.\r\n   * @param target The DOM element.\r\n   * @param rules (optional) rules associated with the binding. Validator implementation specific.\r\n   */\r\n  public registerBinding(binding: Binding, target: Element, rules?: any) {\r\n    this.bindings.set(binding, { target, rules, propertyInfo: null });\r\n  }\r\n\r\n  /**\r\n   * Unregisters a binding with the controller.\r\n   * @param binding The binding instance.\r\n   */\r\n  public unregisterBinding(binding: Binding) {\r\n    this.resetBinding(binding);\r\n    this.bindings.delete(binding);\r\n  }\r\n\r\n  /**\r\n   * Interprets the instruction and returns a predicate that will identify\r\n   * relevant results in the list of rendered validation results.\r\n   */\r\n  private getInstructionPredicate(instruction?: ValidateInstruction): (result: ValidateResult) => boolean {\r\n    if (instruction) {\r\n      const { object, propertyName, rules } = instruction;\r\n      let predicate: (result: ValidateResult) => boolean;\r\n      if (instruction.propertyName) {\r\n        predicate = x => x.object === object && x.propertyName === propertyName;\r\n      } else {\r\n        predicate = x => x.object === object;\r\n      }\r\n      if (rules) {\r\n        return x => predicate(x) && this.validator.ruleExists(rules, x.rule);\r\n      }\r\n      return predicate;\r\n    } else {\r\n      return () => true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates and renders results.\r\n   * @param instruction Optional. Instructions on what to validate. If undefined, all\r\n   * objects and bindings will be validated.\r\n   */\r\n  public validate(instruction?: ValidateInstruction): Promise<ControllerValidateResult> {\r\n    // Get a function that will process the validation instruction.\r\n    let execute: () => Promise<ValidateResult[]>;\r\n    if (instruction) {\r\n      // tslint:disable-next-line:prefer-const\r\n      let { object, propertyName, rules } = instruction;\r\n      // if rules were not specified, check the object map.\r\n      rules = rules || this.objects.get(object);\r\n      // property specified?\r\n      if (instruction.propertyName === undefined) {\r\n        // validate the specified object.\r\n        execute = () => this.validator.validateObject(object, rules);\r\n      } else {\r\n        // validate the specified property.\r\n        execute = () => this.validator.validateProperty(object, propertyName, rules);\r\n      }\r\n    } else {\r\n      // validate all objects and bindings.\r\n      execute = () => {\r\n        const promises: Promise<ValidateResult[]>[] = [];\r\n        for (const [object, rules] of Array.from(this.objects)) {\r\n          promises.push(this.validator.validateObject(object, rules));\r\n        }\r\n        for (const [binding, { rules }] of Array.from(this.bindings)) {\r\n          const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n          if (!propertyInfo || this.objects.has(propertyInfo.object)) {\r\n            continue;\r\n          }\r\n          promises.push(this.validator.validateProperty(propertyInfo.object, propertyInfo.propertyName, rules));\r\n        }\r\n        return Promise.all(promises).then(resultSets => resultSets.reduce((a, b) => a.concat(b), []));\r\n      };\r\n    }\r\n\r\n    // Wait for any existing validation to finish, execute the instruction, render the results.\r\n    this.validating = true;\r\n    const returnPromise: Promise<ControllerValidateResult> = this.finishValidating\r\n      .then(execute)\r\n      .then((newResults: ValidateResult[]) => {\r\n        const predicate = this.getInstructionPredicate(instruction);\r\n        const oldResults = this.results.filter(predicate);\r\n        this.processResultDelta('validate', oldResults, newResults);\r\n        if (returnPromise === this.finishValidating) {\r\n          this.validating = false;\r\n        }\r\n        const result: ControllerValidateResult = {\r\n          instruction,\r\n          valid: newResults.find(x => !x.valid) === undefined,\r\n          results: newResults\r\n        };\r\n        this.invokeCallbacks(instruction, result);\r\n        return result;\r\n      })\r\n      .catch(exception => {\r\n        // recover, to enable subsequent calls to validate()\r\n        this.validating = false;\r\n        this.finishValidating = Promise.resolve();\r\n\r\n        return Promise.reject(exception);\r\n      });\r\n\r\n    this.finishValidating = returnPromise;\r\n\r\n    return returnPromise;\r\n  }\r\n\r\n  /**\r\n   * Resets any rendered validation results (unrenders).\r\n   * @param instruction Optional. Instructions on what to reset. If unspecified all rendered results\r\n   * will be unrendered.\r\n   */\r\n  public reset(instruction?: ValidateInstruction) {\r\n    const predicate = this.getInstructionPredicate(instruction);\r\n    const oldResults = this.results.filter(predicate);\r\n    this.processResultDelta('reset', oldResults, []);\r\n    this.invokeCallbacks(instruction, null);\r\n  }\r\n\r\n  /**\r\n   * Gets the elements associated with an object and propertyName (if any).\r\n   */\r\n  private getAssociatedElements({ object, propertyName }: ValidateResult): Element[] {\r\n    const elements: Element[] = [];\r\n    for (const [binding, { target }] of Array.from(this.bindings)) {\r\n      const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n      if (propertyInfo && propertyInfo.object === object && propertyInfo.propertyName === propertyName) {\r\n        elements.push(target);\r\n      }\r\n    }\r\n    return elements;\r\n  }\r\n\r\n  private processResultDelta(\r\n    kind: 'validate' | 'reset',\r\n    oldResults: ValidateResult[], newResults: ValidateResult[]\r\n  ) {\r\n    // prepare the instruction.\r\n    const instruction: RenderInstruction = {\r\n      kind,\r\n      render: [],\r\n      unrender: []\r\n    };\r\n\r\n    // create a shallow copy of newResults so we can mutate it without causing side-effects.\r\n    newResults = newResults.slice(0);\r\n\r\n    // create unrender instructions from the old results.\r\n    for (const oldResult of oldResults) {\r\n      // get the elements associated with the old result.\r\n      const elements = this.elements.get(oldResult) as Element[];\r\n\r\n      // remove the old result from the element map.\r\n      this.elements.delete(oldResult);\r\n\r\n      // create the unrender instruction.\r\n      instruction.unrender.push({ result: oldResult, elements });\r\n\r\n      // determine if there's a corresponding new result for the old result we are unrendering.\r\n      const newResultIndex = newResults.findIndex(\r\n        x => x.rule === oldResult.rule && x.object === oldResult.object && x.propertyName === oldResult.propertyName);\r\n      if (newResultIndex === -1) {\r\n        // no corresponding new result... simple remove.\r\n        this.results.splice(this.results.indexOf(oldResult), 1);\r\n        if (!oldResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1);\r\n        }\r\n      } else {\r\n        // there is a corresponding new result...\r\n        const newResult = newResults.splice(newResultIndex, 1)[0];\r\n\r\n        // get the elements that are associated with the new result.\r\n        const elements = this.getAssociatedElements(newResult);\r\n        this.elements.set(newResult, elements);\r\n\r\n        // create a render instruction for the new result.\r\n        instruction.render.push({ result: newResult, elements });\r\n\r\n        // do an in-place replacement of the old result with the new result.\r\n        // this ensures any repeats bound to this.results will not thrash.\r\n        this.results.splice(this.results.indexOf(oldResult), 1, newResult);\r\n        if (!oldResult.valid && newResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1);\r\n        } else if (!oldResult.valid && !newResult.valid) {\r\n          this.errors.splice(this.errors.indexOf(oldResult), 1, newResult);\r\n        } else if (!newResult.valid) {\r\n          this.errors.push(newResult);\r\n        }\r\n      }\r\n    }\r\n\r\n    // create render instructions from the remaining new results.\r\n    for (const result of newResults) {\r\n      const elements = this.getAssociatedElements(result);\r\n      instruction.render.push({ result, elements });\r\n      this.elements.set(result, elements);\r\n      this.results.push(result);\r\n      if (!result.valid) {\r\n        this.errors.push(result);\r\n      }\r\n    }\r\n\r\n    // render.\r\n    for (const renderer of this.renderers) {\r\n      renderer.render(instruction);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates the property associated with a binding.\r\n   */\r\n  public validateBinding(binding: Binding) {\r\n    if (!binding.isBound) {\r\n      return;\r\n    }\r\n    const propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n    let rules;\r\n    const registeredBinding = this.bindings.get(binding);\r\n    if (registeredBinding) {\r\n      rules = registeredBinding.rules;\r\n      registeredBinding.propertyInfo = propertyInfo;\r\n    }\r\n    if (!propertyInfo) {\r\n      return;\r\n    }\r\n    const { object, propertyName } = propertyInfo;\r\n    this.validate({ object, propertyName, rules });\r\n  }\r\n\r\n  /**\r\n   * Resets the results for a property associated with a binding.\r\n   */\r\n  public resetBinding(binding: Binding) {\r\n    const registeredBinding = this.bindings.get(binding);\r\n    let propertyInfo = getPropertyInfo(binding.sourceExpression as Expression, binding.source);\r\n    if (!propertyInfo && registeredBinding) {\r\n      propertyInfo = registeredBinding.propertyInfo;\r\n    }\r\n    if (registeredBinding) {\r\n      registeredBinding.propertyInfo = null;\r\n    }\r\n    if (!propertyInfo) {\r\n      return;\r\n    }\r\n    const { object, propertyName } = propertyInfo;\r\n    this.reset({ object, propertyName });\r\n  }\r\n\r\n  /**\r\n   * Changes the controller's validateTrigger.\r\n   * @param newTrigger The new validateTrigger\r\n   */\r\n  public changeTrigger(newTrigger: validateTrigger) {\r\n    this.validateTrigger = newTrigger;\r\n    const bindings = Array.from(this.bindings.keys());\r\n    for (const binding of bindings) {\r\n      const source = binding.source;\r\n      binding.unbind();\r\n      binding.bind(source);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Revalidates the controller's current set of errors.\r\n   */\r\n  public revalidateErrors() {\r\n    for (const { object, propertyName, rule } of this.errors) {\r\n      if (rule.__manuallyAdded__) {\r\n        continue;\r\n      }\r\n      const rules = [[rule]];\r\n      this.validate({ object, propertyName, rules });\r\n    }\r\n  }\r\n\r\n  private invokeCallbacks(instruction: ValidateInstruction | undefined, result: ControllerValidateResult | null) {\r\n    if (this.eventCallbacks.length === 0) {\r\n      return;\r\n    }\r\n    const event = new ValidateEvent(\r\n      result ? 'validate' : 'reset',\r\n      this.errors,\r\n      this.results,\r\n      instruction || null,\r\n      result);\r\n    for (let i = 0; i < this.eventCallbacks.length; i++) {\r\n      this.eventCallbacks[i](event);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Information related to an \"& validate\" decorated binding.\r\n */\r\nexport interface BindingInfo {\r\n  /**\r\n   * The DOM element associated with the binding.\r\n   */\r\n  target: Element;\r\n\r\n  /**\r\n   * The rules associated with the binding via the validate binding behavior's rules parameter.\r\n   */\r\n  rules?: any;\r\n\r\n  /**\r\n   * The object and property associated with the binding.\r\n   */\r\n  propertyInfo: { object: any; propertyName: string; } | null;\r\n}\r\n","// tslint:disable:no-bitwise\r\nimport { Optional } from 'aurelia-dependency-injection';\r\nimport { TaskQueue } from 'aurelia-task-queue';\r\nimport { ValidationController } from './validation-controller';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { getTargetDOMElement } from './get-target-dom-element';\r\nimport { getPropertyInfo } from './property-info';\r\nimport { Expression } from 'aurelia-binding';\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated.\r\n */\r\nexport abstract class ValidateBindingBehaviorBase {\r\n  constructor(private taskQueue: TaskQueue) { }\r\n\r\n  protected abstract getValidateTrigger(controller: ValidationController): validateTrigger;\r\n\r\n  public bind(binding: any, source: any, rulesOrController?: ValidationController | any, rules?: any) {\r\n    // identify the target element.\r\n    const target = getTargetDOMElement(binding, source);\r\n\r\n    // locate the controller.\r\n    let controller: ValidationController;\r\n    if (rulesOrController instanceof ValidationController) {\r\n      controller = rulesOrController;\r\n    } else {\r\n      controller = source.container.get(Optional.of(ValidationController));\r\n      rules = rulesOrController;\r\n    }\r\n    if (controller === null) {\r\n      throw new Error(`A ValidationController has not been registered.`);\r\n    }\r\n\r\n    controller.registerBinding(binding, target, rules);\r\n    binding.validationController = controller;\r\n    const trigger = this.getValidateTrigger(controller);\r\n    const event =\r\n      (trigger & validateTrigger.blur) === validateTrigger.blur ? 'blur'\r\n        : (trigger & validateTrigger.focusout) === validateTrigger.focusout ? 'focusout'\r\n          : null;\r\n    const hasChangeTrigger = (trigger & validateTrigger.change) === validateTrigger.change;\r\n    binding.isDirty = !hasChangeTrigger;\r\n    // validatedOnce is used to control whether controller should validate upon user input\r\n    //\r\n    // always true when validation trigger doesn't include \"blur\" event (blur/focusout)\r\n    // else it will be set to true after (a) the first user input & loss of focus or (b) validation\r\n    binding.validatedOnce = hasChangeTrigger && event === null;\r\n    if (hasChangeTrigger) {\r\n      binding.vbbUpdateSource = binding.updateSource;\r\n      // tslint:disable-next-line:only-arrow-functions\r\n      // tslint:disable-next-line:space-before-function-paren\r\n      binding.updateSource = function (value: any) {\r\n        this.vbbUpdateSource(value);\r\n        this.isDirty = true;\r\n        if (this.validatedOnce) {\r\n          this.validationController.validateBinding(this);\r\n        }\r\n      };\r\n    }\r\n\r\n    if (event !== null) {\r\n      binding.focusLossHandler = () => {\r\n        this.taskQueue.queueMicroTask(() => {\r\n          if (binding.isDirty) {\r\n            controller.validateBinding(binding);\r\n            binding.validatedOnce = true;\r\n          }\r\n        });\r\n      };\r\n      binding.validationTriggerEvent = event;\r\n      binding.validateTarget = target;\r\n      target.addEventListener(event, binding.focusLossHandler);\r\n      if (hasChangeTrigger) {\r\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n        const { propertyName } = getPropertyInfo(binding.sourceExpression as Expression, binding.source)!;\r\n        binding.validationSubscription = controller.subscribe((event) => {\r\n          if (!binding.validatedOnce && event.type === 'validate') {\r\n            binding.validatedOnce = event.errors.findIndex((e) => e.propertyName === propertyName) > -1;\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    if (trigger !== validateTrigger.manual) {\r\n      binding.standardUpdateTarget = binding.updateTarget;\r\n      // tslint:disable-next-line:only-arrow-functions\r\n      // tslint:disable-next-line:space-before-function-paren\r\n      binding.updateTarget = function (value: any) {\r\n        this.standardUpdateTarget(value);\r\n        this.validationController.resetBinding(this);\r\n      };\r\n    }\r\n  }\r\n\r\n  public unbind(binding: any) {\r\n    // reset the binding to it's original state.\r\n    if (binding.vbbUpdateSource) {\r\n      binding.updateSource = binding.vbbUpdateSource;\r\n      binding.vbbUpdateSource = null;\r\n    }\r\n    if (binding.standardUpdateTarget) {\r\n      binding.updateTarget = binding.standardUpdateTarget;\r\n      binding.standardUpdateTarget = null;\r\n    }\r\n    if (binding.focusLossHandler) {\r\n      binding.validateTarget.removeEventListener(binding.validationTriggerEvent, binding.focusLossHandler);\r\n      binding.focusLossHandler = null;\r\n      binding.validateTarget = null;\r\n    }\r\n    if (binding.validationSubscription) {\r\n      binding.validationSubscription.dispose();\r\n      binding.validationSubscription = null;\r\n    }\r\n    binding.validationController.unregisterBinding(binding);\r\n    binding.validationController = null;\r\n    binding.isDirty = null;\r\n    binding.validatedOnce = null;\r\n  }\r\n}\r\n","import { TaskQueue } from 'aurelia-task-queue';\r\nimport { ValidationController } from './validation-controller';\r\nimport { validateTrigger } from './validate-trigger';\r\nimport { ValidateBindingBehaviorBase } from './validate-binding-behavior-base';\r\nimport { bindingBehavior } from 'aurelia-binding';\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the validate trigger specified by the associated controller's\r\n * validateTrigger property occurs.\r\n */\r\n@bindingBehavior('validate')\r\nexport class ValidateBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger(controller: ValidationController) {\r\n    return controller.validateTrigger;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property will be validated\r\n * manually, by calling controller.validate(). No automatic validation\r\n * triggered by data-entry or blur will occur.\r\n */\r\n@bindingBehavior('validateManually')\r\nexport class ValidateManuallyBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.manual;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element blurs.\r\n */\r\n@bindingBehavior('validateOnBlur')\r\nexport class ValidateOnBlurBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.blur;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element is changed by the user, causing a change\r\n * to the model.\r\n */\r\n@bindingBehavior('validateOnChange')\r\nexport class ValidateOnChangeBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.change;\r\n  }\r\n}\r\n\r\n/**\r\n * Binding behavior. Indicates the bound property should be validated\r\n * when the associated element blurs or is changed by the user, causing\r\n * a change to the model.\r\n */\r\n@bindingBehavior('validateOnChangeOrBlur')\r\nexport class ValidateOnChangeOrBlurBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.changeOrBlur;\r\n  }\r\n}\r\n\r\n@bindingBehavior('validateOnFocusout')\r\nexport class ValidateOnFocusoutBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.focusout;\r\n  }\r\n}\r\n\r\n@bindingBehavior('validateOnChangeOrFocusout')\r\nexport class ValidateOnChangeOrFocusoutBindingBehavior extends ValidateBindingBehaviorBase {\r\n  public static inject = [TaskQueue];\r\n\r\n  public getValidateTrigger() {\r\n    return validateTrigger.changeOrFocusout;\r\n  }\r\n}\r\n","import { Container } from 'aurelia-dependency-injection';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { ValidationController } from './validation-controller';\r\nimport { Validator } from './validator';\r\nimport { PropertyAccessorParser } from './property-accessor-parser';\r\n\r\n/**\r\n * Creates ValidationController instances.\r\n */\r\nexport class ValidationControllerFactory {\r\n  public static get(container: Container) {\r\n    return new ValidationControllerFactory(container);\r\n  }\r\n\r\n  constructor(private container: Container) { }\r\n\r\n  /**\r\n   * Creates a new controller instance.\r\n   */\r\n  public create(validator?: Validator) {\r\n    if (!validator) {\r\n      validator = this.container.get(Validator) as Validator;\r\n    }\r\n    const propertyParser = this.container.get(PropertyAccessorParser) as PropertyAccessorParser;\r\n    const config = this.container.get(GlobalValidationConfiguration) as GlobalValidationConfiguration;\r\n    return new ValidationController(validator, propertyParser, config);\r\n  }\r\n\r\n  /**\r\n   * Creates a new controller and registers it in the current element's container so that it's\r\n   * available to the validate binding behavior and renderers.\r\n   */\r\n  public createForCurrentScope(validator?: Validator) {\r\n    const controller = this.create(validator);\r\n    this.container.registerInstance(ValidationController, controller);\r\n    return controller;\r\n  }\r\n}\r\n\r\n(ValidationControllerFactory as any)['protocol:aurelia:resolver'] = true;\r\n","import { bindingMode } from 'aurelia-binding';\r\nimport { Lazy } from 'aurelia-dependency-injection';\r\nimport { customAttribute, bindable } from 'aurelia-templating';\r\nimport { ValidationController } from './validation-controller';\r\nimport { ValidateResult } from './validate-result';\r\nimport { ValidationRenderer, RenderInstruction } from './validation-renderer';\r\nimport { DOM } from 'aurelia-pal';\r\n\r\nexport interface RenderedError {\r\n  error: ValidateResult;\r\n  targets: Element[];\r\n}\r\n\r\n@customAttribute('validation-errors')\r\nexport class ValidationErrorsCustomAttribute implements ValidationRenderer {\r\n\r\n  public static inject(): [typeof DOM.Element, Lazy<ValidationController>] {\r\n    return [DOM.Element, Lazy.of(ValidationController)];\r\n  }\r\n\r\n  @bindable({ defaultBindingMode: bindingMode.oneWay })\r\n  public controller: ValidationController | null = null;\r\n\r\n  @bindable({ primaryProperty: true, defaultBindingMode: bindingMode.twoWay })\r\n  public errors: RenderedError[] = [];\r\n\r\n  private errorsInternal: RenderedError[] = [];\r\n\r\n  constructor(private boundaryElement: Element, private controllerAccessor: () => ValidationController) {\r\n  }\r\n\r\n  public sort() {\r\n    this.errorsInternal.sort((a, b) => {\r\n      if (a.targets[0] === b.targets[0]) {\r\n        return 0;\r\n      }\r\n      // tslint:disable-next-line:no-bitwise\r\n      return a.targets[0].compareDocumentPosition(b.targets[0]) & 2 ? 1 : -1;\r\n    });\r\n  }\r\n\r\n  public interestingElements(elements: Element[]): Element[] {\r\n    return elements.filter(e => this.boundaryElement.contains(e));\r\n  }\r\n\r\n  public render(instruction: RenderInstruction) {\r\n    for (const { result } of instruction.unrender) {\r\n      const index = this.errorsInternal.findIndex(x => x.error === result);\r\n      if (index !== -1) {\r\n        this.errorsInternal.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    for (const { result, elements } of instruction.render) {\r\n      if (result.valid) {\r\n        continue;\r\n      }\r\n      const targets = this.interestingElements(elements);\r\n      if (targets.length) {\r\n        this.errorsInternal.push({ error: result, targets });\r\n      }\r\n    }\r\n\r\n    this.sort();\r\n    this.errors = this.errorsInternal;\r\n  }\r\n\r\n  public bind() {\r\n    if (!this.controller) {\r\n      this.controller = this.controllerAccessor();\r\n    }\r\n    // this will call render() with the side-effect of updating this.errors\r\n    this.controller.addRenderer(this);\r\n  }\r\n\r\n  public unbind() {\r\n    if (this.controller) {\r\n      this.controller.removeRenderer(this);\r\n    }\r\n  }\r\n}\r\n","import { ValidationController } from './validation-controller';\r\nimport { ValidationRenderer } from './validation-renderer';\r\nimport { customAttribute } from 'aurelia-templating';\r\n\r\n@customAttribute('validation-renderer')\r\nexport class ValidationRendererCustomAttribute {\r\n\r\n  private container: any;\r\n  private controller: ValidationController;\r\n  private value: string;\r\n  private renderer: ValidationRenderer;\r\n\r\n  public created(view: any) {\r\n    this.container = view.container;\r\n  }\r\n\r\n  public bind() {\r\n    this.controller = this.container.get(ValidationController);\r\n    this.renderer = this.container.get(this.value);\r\n    this.controller.addRenderer(this.renderer);\r\n  }\r\n\r\n  public unbind() {\r\n    this.controller.removeRenderer(this.renderer);\r\n    this.controller = null as any;\r\n    this.renderer = null as any;\r\n  }\r\n}\r\n","import { Rule, RuleProperty, ValidationDisplayNameAccessor } from './rule';\r\nimport { ValidationMessageParser } from './validation-message-parser';\r\nimport { Rules } from './rules';\r\nimport { validationMessages } from './validation-messages';\r\nimport { PropertyAccessorParser, PropertyAccessor } from '../property-accessor-parser';\r\nimport { isString } from '../util';\r\n\r\n/**\r\n * Part of the fluent rule API. Enables customizing property rules.\r\n */\r\nexport class FluentRuleCustomizer<TObject, TValue> {\r\n  private rule: Rule<TObject, TValue>;\r\n\r\n  constructor(\r\n    property: RuleProperty,\r\n    condition: (value: TValue, object?: TObject) => boolean | Promise<boolean>,\r\n    config: object = {},\r\n    private fluentEnsure: FluentEnsure<TObject>,\r\n    private fluentRules: FluentRules<TObject, TValue>,\r\n    private parsers: Parsers\r\n  ) {\r\n    this.rule = {\r\n      property,\r\n      condition,\r\n      config,\r\n      when: null,\r\n      messageKey: 'default',\r\n      message: null,\r\n      sequence: fluentRules.sequence\r\n    };\r\n    this.fluentEnsure._addRule(this.rule);\r\n  }\r\n\r\n  /**\r\n   * Validate subsequent rules after previously declared rules have\r\n   * been validated successfully. Use to postpone validation of costly\r\n   * rules until less expensive rules pass validation.\r\n   */\r\n  public then() {\r\n    this.fluentRules.sequence++;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies the key to use when looking up the rule's validation message.\r\n   */\r\n  public withMessageKey(key: string) {\r\n    this.rule.messageKey = key;\r\n    this.rule.message = null;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies rule's validation message.\r\n   */\r\n  public withMessage(message: string) {\r\n    this.rule.messageKey = 'custom';\r\n    this.rule.message = this.parsers.message.parse(message);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Specifies a condition that must be met before attempting to validate the rule.\r\n   * @param condition A function that accepts the object as a parameter and returns true\r\n   * or false whether the rule should be evaluated.\r\n   */\r\n  public when(condition: (object: TObject) => boolean) {\r\n    this.rule.when = condition;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Tags the rule instance, enabling the rule to be found easily\r\n   * using ValidationRules.taggedRules(rules, tag)\r\n   */\r\n  public tag(tag: string) {\r\n    this.rule.tag = tag;\r\n    return this;\r\n  }\r\n\r\n  ///// FluentEnsure APIs /////\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor function.\r\n   */\r\n  public ensure<TValue2>(subject: string | ((model: TObject) => TValue2)) {\r\n    return this.fluentEnsure.ensure<TValue2>(subject);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public ensureObject() {\r\n    return this.fluentEnsure.ensureObject();\r\n  }\r\n\r\n  /**\r\n   * Rules that have been defined using the fluent API.\r\n   */\r\n  public get rules() {\r\n    return this.fluentEnsure.rules;\r\n  }\r\n\r\n  /**\r\n   * Applies the rules to a class or object, making them discoverable by the StandardValidator.\r\n   * @param target A class or object.\r\n   */\r\n  public on(target: any) {\r\n    return this.fluentEnsure.on(target);\r\n  }\r\n\r\n  ///////// FluentRules APIs /////////\r\n\r\n  /**\r\n   * Applies an ad-hoc rule function to the ensured property or object.\r\n   * @param condition The function to validate the rule.\r\n   * Will be called with two arguments, the property value and the object.\r\n   * Should return a boolean or a Promise that resolves to a boolean.\r\n   */\r\n  public satisfies(condition: (value: TValue, object: TObject) => boolean | Promise<boolean>, config?: object) {\r\n    return this.fluentRules.satisfies(condition, config);\r\n  }\r\n\r\n  /**\r\n   * Applies a rule by name.\r\n   * @param name The name of the custom or standard rule.\r\n   * @param args The rule's arguments.\r\n   */\r\n  public satisfiesRule(name: string, ...args: any[]) {\r\n    return this.fluentRules.satisfiesRule(name, ...args);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"required\" rule to the property.\r\n   * The value cannot be null, undefined or whitespace.\r\n   */\r\n  public required() {\r\n    return this.fluentRules.required();\r\n  }\r\n\r\n  /**\r\n   * Applies the \"matches\" rule to the property.\r\n   * Value must match the specified regular expression.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public matches(regex: RegExp) {\r\n    return this.fluentRules.matches(regex);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"email\" rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public email() {\r\n    return this.fluentRules.email();\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public minLength(length: number) {\r\n    return this.fluentRules.minLength(length);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public maxLength(length: number) {\r\n    return this.fluentRules.maxLength(length);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public minItems(count: number) {\r\n    return this.fluentRules.minItems(count);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public maxItems(count: number) {\r\n    return this.fluentRules.maxItems(count);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"min\" NUMBER validation rule to the property.\r\n   * Value must be greater than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public min(value: number) {\r\n    return this.fluentRules.min(value);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"max\" NUMBER validation rule to the property.\r\n   * Value must be less than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public max(value: number) {\r\n    return this.fluentRules.max(value);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"range\" NUMBER validation rule to the property.\r\n   * Value must be between or equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public range(min: number, max: number) {\r\n    return this.fluentRules.range(min, max);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"between\" NUMBER validation rule to the property.\r\n   * Value must be between but not equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public between(min: number, max: number) {\r\n    return this.fluentRules.between(min, max);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"equals\" validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public equals(expectedValue: TValue) {\r\n    return this.fluentRules.equals(expectedValue);\r\n  }\r\n}\r\n\r\n/**\r\n * Part of the fluent rule API. Enables applying rules to properties and objects.\r\n */\r\nexport class FluentRules<TObject, TValue> {\r\n  public static customRules: {\r\n    [name: string]: {\r\n      condition: (value: any, object?: any, ...fluentArgs: any[]) => boolean | Promise<boolean>;\r\n      argsToConfig?: (...args: any[]) => any;\r\n    }\r\n  } = {};\r\n\r\n  /**\r\n   * Current rule sequence number. Used to postpone evaluation of rules until rules\r\n   * with lower sequence number have successfully validated. The \"then\" fluent API method\r\n   * manages this property, there's usually no need to set it directly.\r\n   */\r\n  public sequence = 0;\r\n\r\n  constructor(\r\n    private fluentEnsure: FluentEnsure<TObject>,\r\n    private parsers: Parsers,\r\n    private property: RuleProperty\r\n  ) { }\r\n\r\n  /**\r\n   * Sets the display name of the ensured property.\r\n   */\r\n  public displayName(name: string | ValidationDisplayNameAccessor | null) {\r\n    this.property.displayName = name;\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Applies an ad-hoc rule function to the ensured property or object.\r\n   * @param condition The function to validate the rule.\r\n   * Will be called with two arguments, the property value and the object.\r\n   * Should return a boolean or a Promise that resolves to a boolean.\r\n   */\r\n  public satisfies(condition: (value: TValue, object?: TObject) => boolean | Promise<boolean>, config?: object) {\r\n    return new FluentRuleCustomizer<TObject, TValue>(\r\n      this.property, condition, config, this.fluentEnsure, this, this.parsers);\r\n  }\r\n\r\n  /**\r\n   * Applies a rule by name.\r\n   * @param name The name of the custom or standard rule.\r\n   * @param args The rule's arguments.\r\n   */\r\n  public satisfiesRule(name: string, ...args: any[]): FluentRuleCustomizer<TObject, TValue> {\r\n    let rule = FluentRules.customRules[name];\r\n    if (!rule) {\r\n      // standard rule?\r\n      rule = (this as any)[name];\r\n      if (rule instanceof Function) {\r\n        return rule.call(this, ...args);\r\n      }\r\n      throw new Error(`Rule with name \"${name}\" does not exist.`);\r\n    }\r\n    const config = rule.argsToConfig ? rule.argsToConfig(...args) : undefined;\r\n    return this.satisfies((value, obj) => rule.condition.call(this, value, obj, ...args), config)\r\n      .withMessageKey(name);\r\n  }\r\n\r\n  /**\r\n   * Applies the \"required\" rule to the property.\r\n   * The value cannot be null, undefined or whitespace.\r\n   */\r\n  public required() {\r\n    return this.satisfies(\r\n      value =>\r\n        value !== null\r\n        && value !== undefined\r\n        && !(isString(value) && !/\\S/.test(value as any))\r\n    ).withMessageKey('required');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"matches\" rule to the property.\r\n   * Value must match the specified regular expression.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public matches(regex: RegExp) {\r\n    return this.satisfies(\r\n      value => value === null || value === undefined || (value as any).length === 0 || regex.test(value as any))\r\n      .withMessageKey('matches');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"email\" rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public email() {\r\n    // regex from https://html.spec.whatwg.org/multipage/forms.html#valid-e-mail-address\r\n    /* tslint:disable:max-line-length */\r\n    return this.matches(/^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/)\r\n      /* tslint:enable:max-line-length */\r\n      .withMessageKey('email');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public minLength(length: number) {\r\n    return this.satisfies(\r\n      (value: any) => value === null || value === undefined || value.length === 0 || value.length >= length,\r\n      { length })\r\n      .withMessageKey('minLength');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxLength\" STRING validation rule to the property.\r\n   * null, undefined and empty-string values are considered valid.\r\n   */\r\n  public maxLength(length: number) {\r\n    return this.satisfies(\r\n      (value: any) => value === null || value === undefined || value.length === 0 || value.length <= length,\r\n      { length })\r\n      .withMessageKey('maxLength');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"minItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public minItems(count: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value.length >= count, { count })\r\n      .withMessageKey('minItems');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"maxItems\" ARRAY validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public maxItems(count: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value.length <= count, { count })\r\n      .withMessageKey('maxItems');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"min\" NUMBER validation rule to the property.\r\n   * Value must be greater than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public min(constraint: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value >= constraint, { constraint })\r\n      .withMessageKey('min');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"max\" NUMBER validation rule to the property.\r\n   * Value must be less than or equal to the specified constraint.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public max(constraint: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || value <= constraint, { constraint })\r\n      .withMessageKey('max');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"range\" NUMBER validation rule to the property.\r\n   * Value must be between or equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public range(min: number, max: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || (value >= min && value <= max),\r\n      { min, max })\r\n      .withMessageKey('range');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"between\" NUMBER validation rule to the property.\r\n   * Value must be between but not equal to the specified min and max.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public between(min: number, max: number) {\r\n    return this.satisfies((value: any) => value === null || value === undefined || (value > min && value < max),\r\n      { min, max })\r\n      .withMessageKey('between');\r\n  }\r\n\r\n  /**\r\n   * Applies the \"equals\" validation rule to the property.\r\n   * null and undefined values are considered valid.\r\n   */\r\n  public equals(expectedValue: TValue) {\r\n    return this.satisfies(\r\n      value => value === null || value === undefined || value as any === '' || value === expectedValue,\r\n      { expectedValue })\r\n      .withMessageKey('equals');\r\n  }\r\n}\r\n\r\n/**\r\n * Part of the fluent rule API. Enables targeting properties and objects with rules.\r\n */\r\nexport class FluentEnsure<TObject> {\r\n  /**\r\n   * Rules that have been defined using the fluent API.\r\n   */\r\n  public rules: Rule<TObject, any>[][] = [];\r\n\r\n  constructor(private parsers: Parsers) { }\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor\r\n   * function.\r\n   */\r\n  public ensure<TValue>(property: string | number | PropertyAccessor<TObject, TValue>): FluentRules<TObject, any> {\r\n    this.assertInitialized();\r\n    const name = this.parsers.property.parse(property);\r\n    const fluentRules = new FluentRules<TObject, TValue>(\r\n      this,\r\n      this.parsers,\r\n      { name, displayName: null });\r\n    return this.mergeRules(fluentRules, name);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public ensureObject(): FluentRules<TObject, any> {\r\n    this.assertInitialized();\r\n    const fluentRules = new FluentRules<TObject, TObject>(\r\n      this, this.parsers, { name: null, displayName: null });\r\n    return this.mergeRules(fluentRules, null);\r\n  }\r\n\r\n  /**\r\n   * Applies the rules to a class or object, making them discoverable by the StandardValidator.\r\n   * @param target A class or object.\r\n   */\r\n  public on(target: any) {\r\n    Rules.set(target, this.rules);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Adds a rule definition to the sequenced ruleset.\r\n   * @internal\r\n   */\r\n  public _addRule(rule: Rule<TObject, any>) {\r\n    while (this.rules.length < rule.sequence + 1) {\r\n      this.rules.push([]);\r\n    }\r\n    this.rules[rule.sequence].push(rule);\r\n  }\r\n\r\n  private assertInitialized() {\r\n    if (this.parsers) {\r\n      return;\r\n    }\r\n    throw new Error(`Did you forget to add \".plugin('aurelia-validation')\" to your main.js?`);\r\n  }\r\n\r\n  private mergeRules(fluentRules: FluentRules<TObject, any>, propertyName: string | number | null) {\r\n    // tslint:disable-next-line:triple-equals | Use loose equality for property keys\r\n    const existingRules = this.rules.find(r => r.length > 0 && r[0].property.name == propertyName);\r\n    if (existingRules) {\r\n      const rule = existingRules[existingRules.length - 1];\r\n      fluentRules.sequence = rule.sequence;\r\n      if (rule.property.displayName !== null) {\r\n        fluentRules = fluentRules.displayName(rule.property.displayName);\r\n      }\r\n    }\r\n    return fluentRules;\r\n  }\r\n}\r\n\r\n/**\r\n * Fluent rule definition API.\r\n */\r\nexport class ValidationRules {\r\n  private static parsers: Parsers;\r\n\r\n  public static initialize(messageParser: ValidationMessageParser, propertyParser: PropertyAccessorParser) {\r\n    this.parsers = {\r\n      message: messageParser,\r\n      property: propertyParser\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Target a property with validation rules.\r\n   * @param property The property to target. Can be the property name or a property accessor function.\r\n   */\r\n  public static ensure<TObject, TValue>(property: string | number | PropertyAccessor<TObject, TValue>) {\r\n    return new FluentEnsure<TObject>(ValidationRules.parsers).ensure(property);\r\n  }\r\n\r\n  /**\r\n   * Targets an object with validation rules.\r\n   */\r\n  public static ensureObject<TObject>() {\r\n    return new FluentEnsure<TObject>(ValidationRules.parsers).ensureObject();\r\n  }\r\n\r\n  /**\r\n   * Defines a custom rule.\r\n   * @param name The name of the custom rule. Also serves as the message key.\r\n   * @param condition The rule function.\r\n   * @param message The message expression\r\n   * @param argsToConfig A function that maps the rule's arguments to a \"config\"\r\n   * object that can be used when evaluating the message expression.\r\n   */\r\n  public static customRule(\r\n    name: string,\r\n    condition: (value: any, object?: any, ...args: any[]) => boolean | Promise<boolean>,\r\n    message: string,\r\n    argsToConfig?: (...args: any[]) => any\r\n  ) {\r\n    validationMessages[name] = message;\r\n    FluentRules.customRules[name] = { condition, argsToConfig };\r\n  }\r\n\r\n  /**\r\n   * Returns rules with the matching tag.\r\n   * @param rules The rules to search.\r\n   * @param tag The tag to search for.\r\n   */\r\n  public static taggedRules(rules: Rule<any, any>[][], tag: string): Rule<any, any>[][] {\r\n    return rules.map(x => x.filter(r => r.tag === tag));\r\n  }\r\n\r\n  /**\r\n   * Returns rules that have no tag.\r\n   * @param rules The rules to search.\r\n   */\r\n  public static untaggedRules(rules: Rule<any, any>[][]): Rule<any, any>[][] {\r\n    return rules.map(x => x.filter(r => r.tag === undefined));\r\n  }\r\n\r\n  /**\r\n   * Removes the rules from a class or object.\r\n   * @param target A class or object.\r\n   */\r\n  public static off(target: any): void {\r\n    Rules.unset(target);\r\n  }\r\n}\r\n\r\nexport interface Parsers {\r\n  message: ValidationMessageParser;\r\n  property: PropertyAccessorParser;\r\n}\r\n","// Exports\r\n\r\nexport * from './config';\r\nexport * from './controller-validate-result';\r\nexport * from './get-target-dom-element';\r\nexport * from './property-info';\r\nexport * from './property-accessor-parser';\r\nexport * from './validate-binding-behavior';\r\nexport * from './validate-event';\r\nexport * from './validate-instruction';\r\nexport * from './validate-result';\r\nexport * from './validate-trigger';\r\nexport * from './validation-controller';\r\nexport * from './validation-controller-factory';\r\nexport * from './validation-errors-custom-attribute';\r\nexport * from './validation-renderer-custom-attribute';\r\nexport * from './validation-renderer';\r\nexport * from './validator';\r\n\r\nexport * from './implementation/rule';\r\nexport * from './implementation/rules';\r\nexport * from './implementation/standard-validator';\r\nexport * from './implementation/validation-messages';\r\nexport * from './implementation/validation-message-parser';\r\nexport * from './implementation/validation-rules';\r\n\r\n// Configuration\r\n\r\nimport { Container } from 'aurelia-dependency-injection';\r\nimport { GlobalValidationConfiguration } from './config';\r\nimport { ValidationMessageParser } from './implementation/validation-message-parser';\r\nimport { PropertyAccessorParser } from './property-accessor-parser';\r\nimport { ValidationRules } from './implementation/validation-rules';\r\nimport {\r\n  ValidateBindingBehavior,\r\n  ValidateManuallyBindingBehavior,\r\n  ValidateOnBlurBindingBehavior,\r\n  ValidateOnChangeBindingBehavior,\r\n  ValidateOnChangeOrBlurBindingBehavior,\r\n  ValidateOnFocusoutBindingBehavior,\r\n  ValidateOnChangeOrFocusoutBindingBehavior\r\n} from './validate-binding-behavior';\r\nimport { ValidationErrorsCustomAttribute } from './validation-errors-custom-attribute';\r\nimport { ValidationRendererCustomAttribute } from './validation-renderer-custom-attribute';\r\n\r\n/**\r\n * Configures the plugin.\r\n */\r\nexport function configure(\r\n  // tslint:disable-next-line:ban-types\r\n  frameworkConfig: { container: Container, globalResources?: (...resources: any[]) => any },\r\n  callback?: (config: GlobalValidationConfiguration) => void\r\n) {\r\n  // the fluent rule definition API needs the parser to translate messages\r\n  // to interpolation expressions.\r\n  const messageParser = frameworkConfig.container.get(ValidationMessageParser);\r\n  const propertyParser = frameworkConfig.container.get(PropertyAccessorParser);\r\n  ValidationRules.initialize(messageParser, propertyParser);\r\n\r\n  // configure...\r\n  const config = new GlobalValidationConfiguration();\r\n  if (callback instanceof Function) {\r\n    callback(config);\r\n  }\r\n  config.apply(frameworkConfig.container);\r\n\r\n  // globalize the behaviors.\r\n  if (frameworkConfig.globalResources) {\r\n    frameworkConfig.globalResources(\r\n      ValidateBindingBehavior,\r\n      ValidateManuallyBindingBehavior,\r\n      ValidateOnBlurBindingBehavior,\r\n      ValidateOnFocusoutBindingBehavior,\r\n      ValidateOnChangeBindingBehavior,\r\n      ValidateOnChangeOrBlurBindingBehavior,\r\n      ValidateOnChangeOrFocusoutBindingBehavior,\r\n      ValidationErrorsCustomAttribute,\r\n      ValidationRendererCustomAttribute);\r\n  }\r\n}\r\n"],"names":["LiteralString","LiteralPrimitive","Binary","Conditional","CallMember","BindingLanguage","LogManager","ViewResources","validateTrigger","DOM","BindingBehavior","ValueConverter","AccessScope","getContextFor","AccessMember","AccessKeyed","Parser","Optional","TaskQueue","bindingBehavior","Lazy","bindable","bindingMode","customAttribute"],"mappings":"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"}